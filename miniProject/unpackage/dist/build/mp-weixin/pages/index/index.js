"use strict";const e=require("../../common/vendor.js"),o=require("../../utils/userStorage.js"),n=require("../../uni_modules/wot-design-uni/components/wd-toast/index.js"),s=require("../../uni_modules/wot-design-uni/components/wd-message-box/index.js"),i=require("../../uni_modules/wot-design-uni/components/composables/useQueue.js");require("../../uni_modules/wot-design-uni/locale/index.js");const t=require("../../api/articleApi.js");if(!Array){(e.resolveComponent("wd-skeleton")+e.resolveComponent("wd-notice-bar")+e.resolveComponent("wd-search")+e.resolveComponent("wd-img")+e.resolveComponent("wd-text")+e.resolveComponent("wd-loading")+e.resolveComponent("wd-icon")+e.resolveComponent("wd-popover")+e.resolveComponent("wd-status-tip")+e.resolveComponent("wd-loadmore")+e.resolveComponent("wd-fab")+e.resolveComponent("wd-toast")+e.resolveComponent("wd-message-box"))()}Math||((()=>"../../uni_modules/wot-design-uni/components/wd-skeleton/wd-skeleton.js")+(()=>"../../uni_modules/wot-design-uni/components/wd-notice-bar/wd-notice-bar.js")+(()=>"../../uni_modules/wot-design-uni/components/wd-search/wd-search.js")+(()=>"../../uni_modules/wot-design-uni/components/wd-img/wd-img.js")+(()=>"../../uni_modules/wot-design-uni/components/wd-text/wd-text.js")+(()=>"../../uni_modules/wot-design-uni/components/wd-loading/wd-loading.js")+(()=>"../../uni_modules/wot-design-uni/components/wd-icon/wd-icon.js")+(()=>"../../uni_modules/wot-design-uni/components/wd-popover/wd-popover.js")+(()=>"../../uni_modules/wot-design-uni/components/wd-status-tip/wd-status-tip.js")+(()=>"../../uni_modules/wot-design-uni/components/wd-loadmore/wd-loadmore.js")+(()=>"../../uni_modules/wot-design-uni/components/wd-fab/wd-fab.js")+(()=>"../../uni_modules/wot-design-uni/components/wd-toast/wd-toast.js")+(()=>"../../uni_modules/wot-design-uni/components/wd-message-box/wd-message-box.js"))();const a=e.defineComponent({__name:"index",setup(a,{expose:l}){s.useMessage();const{closeOutside:d}=i.useQueue(),r=e.ref(!0),u=n.useToast(),c=e.ref(""),g=e=>{console.log("搜索:",e)},m=()=>{r.value=!1},p=()=>{console.log("点击活动模块"),e.index.navigateTo({url:"/pages/activity/activity"})},w=()=>{console.log("点击社团圈模块"),e.index.navigateTo({url:"/pages/club/club"})},v=()=>{e.index.navigateTo({url:"/pages/study/study"}),console.log("点击学习圈模块")},h=()=>{e.index.navigateTo({url:"/pages/lostFound/lostFound"}),console.log("点击失物招领模块")},f=e.ref([]),x=e.reactive({current:1,pageSize:5,total:0,hasMore:!0,isRefreshing:!1}),_=e.ref("loading"),j=e.ref(!1),C=e=>{switch(e){case 1:return"one-column";case 2:case 4:return"two-columns";default:return"three-columns"}};e.onReachBottom((()=>{console.log("到底部了"),console.log(f.value),b()})),e.onPullDownRefresh((()=>{x.isRefreshing||b(!0).then((()=>{u.show("加载成功")})).finally((()=>{setTimeout((()=>{e.index.stopPullDownRefresh()}),500)}))}));const b=async(o=!1)=>{if(!x.isRefreshing){x.isRefreshing=!0;try{if(o&&(x.current=1,x.hasMore=!0,f.value=[],e.index.showNavigationBarLoading()),!x.hasMore)return void(_.value="finished");const n=await t.getArticleList({current:x.current,pageSize:x.pageSize});200===n.code&&(f.value=o?n.data.records:[...f.value,...n.data.records],x.total=n.data.total,x.hasMore=x.current*x.pageSize<n.data.total,x.current+=1,_.value=x.hasMore?"loading":"finished")}catch(n){console.error("加载失败:",n),_.value="error"}finally{x.isRefreshing=!1,e.index.hideNavigationBarLoading(),e.index.stopPullDownRefresh()}}},L=()=>{console.log("加载......"),_.value="loading",b()},k=o=>{e.index.navigateTo({url:`/pages/articleInfo/articleInfo?articleId=${o}`})},y=()=>{const n=o.getUserInfo();console.log(n),n?e.index.navigateTo({url:"/pages/publishArticle/publishArticle"}):(u.show({iconClass:"info-circle",position:"middle",msg:"请先登录"}),setTimeout((()=>{e.index.reLaunch({url:"/pages/login/login"})}),1e3))};e.onShow((()=>{if(j.value){console.log("需要刷新页面");const e=getCurrentPages();console.log("当前页面栈:",e.map((e=>e.route))),x.current=1,x.hasMore=!0,f.value=[],b(!0),j.value=!1}})),e.onLoad((()=>{b()}));const T=e.ref([{iconClass:"warning",content:"举报"}]);e.onLoad((()=>{b()}));return l({setNeedRefresh:()=>{j.value=!0}}),e.onShareAppMessage((e=>(console.log(e),{title:"青春共享站",path:"/pages/index/index",imageUrl:"/static/logo.jpg"}))),e.onShareTimeline((()=>({title:"青春共享站",path:"/pages/index/index",imageUrl:"/static/logo.jpg"}))),(o,n)=>e.e({a:e.o(m),b:e.p({theme:"image",animation:"flashed",loading:r.value}),c:e.p({text:"声明公告：平台内禁止发布任何有关政治立场、色情、暴力等一系列非法言论，如有发现将封禁处理，所有用户均可发布内容，谁发布谁负责",prefix:"check-outline",type:"info","custom-class":"space"}),d:e.o(g),e:e.o((e=>c.value=e)),f:e.p({placeholder:"搜索","hide-cancel":!0,modelValue:c.value}),g:e.o(p),h:e.o(w),i:e.o(v),j:e.o(h),k:e.f(f.value,((o,n,s)=>e.e({a:"31c149ed-3-"+s,b:e.p({src:o.userVO.imageUrl,width:45,height:45,round:!0,mode:"scaleToFill"}),c:e.t(o.userVO.userName),d:e.t(o.createTime),e:e.o((n=>{return s=o.userVO.id,console.log("id",s),void e.index.navigateTo({url:`/pages/userDetail/userDetail?userId=${s}`});var s}),n),f:"31c149ed-4-"+s,g:e.p({text:o.content,color:"#565756",size:"14px",lines:4}),h:e.o((e=>k(o.id)),n),i:null!=o.imagesList},null!=o.imagesList?{j:e.f(o.imagesList.slice(0,9),((n,i,t)=>e.e({a:"31c149ed-6-"+s+"-"+t+",31c149ed-5-"+s+"-"+t,b:e.o((s=>((o,n)=>{e.index.previewImage({current:o,urls:n})})(n,o.imagesList)),i),c:"31c149ed-5-"+s+"-"+t,d:e.p({width:"100%",height:"100%",mode:"aspectFill","show-menu-by-longpress":!0,radius:"5px",src:n}),e:8===i&&o.imagesList.length>9},8===i&&o.imagesList.length>9?{f:e.t(o.imagesList.length-9)}:{},{g:i}))),k:e.o((e=>k(o.id)),n),l:e.n(C(o.imagesList.length))}:{},{m:"31c149ed-7-"+s,n:e.t(o.viewCount),o:o.isLike},(o.isLike,{}),{p:e.t(o.likeCount),q:e.o((e=>(async(e,o)=>{console.log(e,o);const n=await t.likeArticle(e);200==n.code?f.value[o].isLike?(f.value[o].likeCount-=1,f.value[o].isLike=!1):(f.value[o].likeCount+=1,f.value[o].isLike=!0):u.show(n.message)})(o.id,n)),n),r:"31c149ed-8-"+s,s:e.t(o.commentCount),t:e.o((e=>k(o.id)),n),v:"31c149ed-10-"+s+",31c149ed-9-"+s,w:e.o((e=>{return n=o.id,console.log(n),void u.show("敬请期待");var n}),n),x:"31c149ed-9-"+s,y:e.o(((...o)=>e.unref(d)&&e.unref(d)(...o)),n),z:n}))),l:e.p({name:"view",size:"16px"}),m:e.p({name:"chat",size:"16px"}),n:e.p({name:"more",size:"16px"}),o:e.p({mode:"menu",content:T.value}),p:0==f.value.length},0==f.value.length?{q:e.p({image:"content",tip:"暂无内容"})}:{},{r:f.value.length>0},f.value.length>0?{s:e.o(L),t:e.p({"custom-class":"loadmore",state:_.value,"loading-text":"别急在跑了...","finished-text":"已经没有啦~","error-text":"与火星断联了~，点击重试"})}:{},{v:e.o(y),w:e.p({expandable:!1,inactiveIcon:"edit-outline",position:"right-bottom"})})}});a.__runtimeHooks=6;const l=e._export_sfc(a,[["__scopeId","data-v-31c149ed"]]);wx.createPage(l);
