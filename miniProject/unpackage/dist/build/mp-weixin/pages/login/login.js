"use strict";const e=require("../../common/vendor.js"),o=require("../../uni_modules/wot-design-uni/components/wd-toast/index.js");require("../../uni_modules/wot-design-uni/locale/index.js");const n=require("../../api/userApi.js"),s=require("../../utils/userStorage.js");if(!Array){(e.resolveComponent("wd-navbar")+e.resolveComponent("wd-button")+e.resolveComponent("wd-toast"))()}Math||((()=>"../../uni_modules/wot-design-uni/components/wd-navbar/wd-navbar.js")+(()=>"../../uni_modules/wot-design-uni/components/wd-button/wd-button.js")+(()=>"../../uni_modules/wot-design-uni/components/wd-toast/wd-toast.js"))();const t=e.defineComponent({__name:"login",setup(t){const a=o.useToast(),i=async o=>{if(o.code){e.index.showLoading({title:"登录中..."});try{const t=await n.wxLogin(o.code);200===t.code?(console.log(t.data),e.index.setStorageSync("token",t.data.token),s.setUserInfo(t.data),a.success("登录成功"),setTimeout((()=>{e.index.switchTab({url:"/pages/index/index"})}),1e3)):a.error(t.message||"登录失败")}catch(t){console.error("登录错误:",t),a.error("登录失败，请重试")}finally{e.index.hideLoading()}}else a.error("未授权手机号，请重试")},r=()=>{e.index.switchTab({url:"/pages/index/index"})},d=()=>{e.index.navigateTo({url:"/pages/agreement/user"})},c=()=>{e.index.navigateTo({url:"/pages/agreement/privacy"})};return e.onLoad((()=>{s.clearUserInfo()})),(o,n)=>({a:e.p({"custom-class":"navbar",bordered:!1,title:"登录",safeAreaInsetTop:!0}),b:e.o(i),c:e.p({icon:"wechat",type:"success",block:!0,"open-type":"getPhoneNumber"}),d:e.o(r),e:e.p({type:"info",block:!0,plain:!0}),f:e.o(d),g:e.o(c)})}}),a=e._export_sfc(t,[["__scopeId","data-v-c4395fbd"]]);wx.createPage(a);
