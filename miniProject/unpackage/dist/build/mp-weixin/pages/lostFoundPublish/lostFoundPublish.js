"use strict";const e=require("../../common/vendor.js"),o=require("../../uni_modules/wot-design-uni/components/wd-toast/index.js"),t=require("../../uni_modules/wot-design-uni/components/common/dayjs.js");require("../../uni_modules/wot-design-uni/locale/index.js");const l=require("../../api/uploadApi.js"),n=require("../../utils/userStorage.js"),i=require("../../api/itemsApi.js");if(!Array){(e.resolveComponent("wd-input")+e.resolveComponent("wd-datetime-picker")+e.resolveComponent("wd-tag")+e.resolveComponent("wd-upload")+e.resolveComponent("wd-button")+e.resolveComponent("wd-toast"))()}Math||((()=>"../../uni_modules/wot-design-uni/components/wd-input/wd-input.js")+(()=>"../../uni_modules/wot-design-uni/components/wd-datetime-picker/wd-datetime-picker.js")+(()=>"../../uni_modules/wot-design-uni/components/wd-tag/wd-tag.js")+(()=>"../../uni_modules/wot-design-uni/components/wd-upload/wd-upload.js")+(()=>"../../uni_modules/wot-design-uni/components/wd-button/wd-button.js")+(()=>"../../uni_modules/wot-design-uni/components/wd-toast/wd-toast.js"))();const s=e.defineComponent({__name:"lostFoundPublish",setup(s){const a=o.useToast(),r=e.ref(),u=e.ref(Date.now()),d=e.ref(["手机数码","证件卡片","钱包","钥匙","包包","衣物","首饰配件","图书资料","生活用品","其他"]),c=e.ref({category:"",description:"",eventTime:"",itemType:1,location:"",currentLocation:"",title:"",urlList:[],userId:0}),p=e=>{console.log("files:",e),console.log(r.value),r.value=e},m=e=>{const o=c.value.urlList[e.index];console.log("删除前置处理",o),l.deleteFile(o).then((o=>{200===o.code?(console.log("删除成功",o),r.value.splice(e.index,1),c.value.urlList.splice(e.index,1),console.log("publishArticleParams>>>",c)):console.log("删除失败",o)}))},v=e=>{console.log("上传成功res",e.file.response);const o=JSON.parse(e.file.response);console.log("上传成功result.data",o.data),c.value.urlList.push(...o.data),console.log(c.value)},g=async()=>{if((()=>{var e,o,t,l,n;const i=c.value;return(null==(e=i.title)?void 0:e.trim())?(null==(o=i.description)?void 0:o.trim())?(null==(t=i.location)?void 0:t.trim())?u?(null==(l=i.category)?void 0:l.trim())?!(2===i.itemType&&!(null==(n=i.currentLocation)?void 0:n.trim())&&(a.show("请输入当前物品位置"),1)):(a.show("请选择物品类型"),!1):(a.show("请选择时间"),!1):(a.show("请输入丢失/拾获地点"),!1):(a.show("请输入描述"),!1):(a.show("请输入标题"),!1)})()){c.value.eventTime=t.dayjs(u.value).format("YYYY-MM-DD HH:mm:ss"),e.index.showLoading({title:"发布中",mask:!0});try{const o=await i.addItems(c.value);if(200===o.code){a.show({msg:"发布成功",cover:!0});const o=getCurrentPages(),t=o[o.length-2];setTimeout((()=>{t&&"pages/lostFound/lostFound"===t.route&&("function"==typeof t.$vm.setNeedRefresh?(console.log("调用刷新方法"),t.$vm.setNeedRefresh()):console.error("setNeedRefresh 方法未找到")),e.index.navigateBack({delta:1})}),1500)}else a.error(o.message)}catch(o){console.error("发布失败:",o),a.error("发布失败，请重试")}finally{e.index.hideLoading()}}},w=e=>{c.value.itemType=e,1===e&&(c.value.currentLocation="")};return e.onLoad((e=>{const o=n.getUserInfo();if(c.value.userId=null==o?void 0:o.id,e&&e.type){const o=parseInt(e.type);console.log("type>>",o),c.value.itemType=o,2===o&&(c.value.currentLocation="")}})),e.onShareAppMessage((e=>(console.log(e),{title:"青春共享站",path:"/pages/index/index",imageUrl:"/static/logo.jpg"}))),e.onShareTimeline((()=>({title:"青春共享站",path:"/pages/index/index",imageUrl:"/static/logo.jpg"}))),(o,t)=>e.e({a:1===c.value.itemType?1:"",b:e.o((e=>{w(1),c.value.currentLocation=""})),c:2===c.value.itemType?1:"",d:e.o((e=>w(2))),e:e.o((e=>c.value.title=e)),f:e.p({placeholder:"请输入标题",clearable:!0,maxlength:20,"show-word-limit":!0,modelValue:c.value.title}),g:e.o((e=>u.value=e)),h:e.p({label:"",modelValue:u.value}),i:e.o((e=>c.value.location=e)),j:e.p({placeholder:"请输入掉落地点",clearable:!0,modelValue:c.value.location}),k:e.o((e=>c.value.description=e)),l:e.p({placeholder:"请输入物品描述",type:"textarea",rows:3,modelValue:c.value.description}),m:e.f(d.value,((o,t,l)=>({a:e.t(o),b:o,c:e.o((e=>(e=>{c.value.category=e})(o)),o),d:"b0e6463b-4-"+l,e:e.p({type:c.value.category===o?"primary":"default",round:!0})}))),n:2==c.value.itemType},2==c.value.itemType?{o:e.o((e=>c.value.currentLocation=e)),p:e.p({placeholder:"请输入物品当前所在地",clearable:!0,modelValue:c.value.currentLocation})}:{},{q:e.sr("uploadFile","b0e6463b-6"),r:e.o(p),s:e.o(v),t:e.o((e=>r.value=e)),v:e.p({limit:6,multiple:!0,accept:"image",action:"https://campus.fybreeze.cn/api/article/uploadImages","before-remove":m,"file-list":r.value}),w:e.o(g),x:e.p({type:"primary",block:!0})})}});s.__runtimeHooks=6;const a=e._export_sfc(s,[["__scopeId","data-v-b0e6463b"]]);wx.createPage(a);
