"use strict";const e=require("../../common/vendor.js"),i=require("../../api/articleApi.js"),a=require("../../utils/userStorage.js"),o=require("../../uni_modules/wot-design-uni/components/wd-toast/index.js");require("../../uni_modules/wot-design-uni/locale/index.js");const t=require("../../utils/activityEnum.js"),n=require("../../api/activityApi.js");if(!Array){(e.resolveComponent("wd-img")+e.resolveComponent("wd-icon")+e.resolveComponent("wd-tag")+e.resolveComponent("wd-cell")+e.resolveComponent("wd-cell-group")+e.resolveComponent("wd-popup")+e.resolveComponent("wd-segmented")+e.resolveComponent("wd-text")+e.resolveComponent("wd-loading")+e.resolveComponent("wd-popover")+e.resolveComponent("wd-loadmore")+e.resolveComponent("wd-toast"))()}Math||((()=>"../../uni_modules/wot-design-uni/components/wd-img/wd-img.js")+(()=>"../../uni_modules/wot-design-uni/components/wd-icon/wd-icon.js")+(()=>"../../uni_modules/wot-design-uni/components/wd-tag/wd-tag.js")+(()=>"../../uni_modules/wot-design-uni/components/wd-cell/wd-cell.js")+(()=>"../../uni_modules/wot-design-uni/components/wd-cell-group/wd-cell-group.js")+(()=>"../../uni_modules/wot-design-uni/components/wd-popup/wd-popup.js")+(()=>"../../uni_modules/wot-design-uni/components/wd-segmented/wd-segmented.js")+(()=>"../../uni_modules/wot-design-uni/components/wd-text/wd-text.js")+(()=>"../../uni_modules/wot-design-uni/components/wd-loading/wd-loading.js")+(()=>"../../uni_modules/wot-design-uni/components/wd-popover/wd-popover.js")+(()=>"../../uni_modules/wot-design-uni/components/wd-loadmore/wd-loadmore.js")+(()=>"../../uni_modules/wot-design-uni/components/wd-toast/wd-toast.js"))();const s=e.defineComponent({__name:"my",setup(s){const l=e.ref({}),r=o.useToast(),u=e.ref([]),d=e.ref([]),c=e.ref("loading"),g=e.reactive({current:1,pageSize:5,total:0,userId:null,hasMore:!0,isRefreshing:!1}),v=e.reactive({current:1,pageSize:5,hasMore:!0,isRefreshing:!1}),p=e.ref(["投稿","活动","收藏","喜欢"]),m=e.ref("投稿");e.ref(!1);const h=e.ref([]),f=e.reactive({current:1,pageSize:5,hasMore:!0,isRefreshing:!1}),w=e.ref([]),x=e.reactive({current:1,pageSize:5,hasMore:!0,isRefreshing:!1}),b=e=>{switch(e){case 1:return"one-column";case 2:case 4:return"two-columns";default:return"three-columns"}},L=i=>{e.index.navigateTo({url:`/pages/articleInfo/articleInfo?articleId=${i}`})},y=()=>{console.log("加载......"),c.value="loading",R()},R=async(a=!1)=>{if(S.value){if(!g.isRefreshing){g.isRefreshing=!0;try{if(a&&(g.current=1,g.hasMore=!0,u.value=[],e.index.showNavigationBarLoading()),!g.hasMore)return void(c.value="finished");const o=await i.getArticleList({current:g.current,pageSize:g.pageSize,userId:g.userId});200===o.code&&(u.value=a?o.data.records:[...u.value,...o.data.records],g.total=o.data.total,g.hasMore=g.current*g.pageSize<o.data.total,g.current+=1,c.value=g.hasMore?"loading":"finished")}catch(o){console.error("加载失败:",o),c.value="error"}finally{g.isRefreshing=!1,e.index.hideNavigationBarLoading(),e.index.stopPullDownRefresh()}}}else c.value="finished"},j=async(i=!1)=>{if(S.value){if(!v.isRefreshing){v.isRefreshing=!0;try{if(i&&(v.current=1,v.hasMore=!0,d.value=[],e.index.showNavigationBarLoading()),!v.hasMore)return void(c.value="finished");const a=await n.getActivityVOByJoinUserId(l.value.id);200===a.code?(d.value=i?a.data:[...d.value,...a.data],v.hasMore=!1,c.value="finished"):r.error(a.message)}catch(a){console.error("获取活动列表失败:",a),c.value="error"}finally{v.isRefreshing=!1,e.index.hideNavigationBarLoading(),e.index.stopPullDownRefresh()}}}else c.value="finished"},M=async(i=!1)=>{var a;if(S.value){if(!f.isRefreshing){f.isRefreshing=!0;try{if(i&&(f.current=1,f.hasMore=!0,h.value=[],e.index.showNavigationBarLoading()),!f.hasMore)return void(c.value="finished");console.log("获取收藏列表:",{current:f.current,pageSize:f.pageSize,userId:null==(a=l.value)?void 0:a.id}),c.value="finished"}catch(o){console.error("获取收藏列表失败:",o),c.value="error"}finally{f.isRefreshing=!1,e.index.hideNavigationBarLoading(),e.index.stopPullDownRefresh()}}}else c.value="finished"},k=async(a=!1)=>{var o;if(S.value){if(!x.isRefreshing){x.isRefreshing=!0;try{if(a&&(x.current=1,x.hasMore=!0,w.value=[],e.index.showNavigationBarLoading()),!x.hasMore)return void(c.value="finished");const t=await i.getArticleVOLikeListByUserId(null==(o=l.value)?void 0:o.id);console.log(t),200==t.code?w.value=t.data:r.error(t.msg),c.value="finished"}catch(t){console.error("获取点赞列表失败:",t),c.value="error"}finally{x.isRefreshing=!1,e.index.hideNavigationBarLoading(),e.index.stopPullDownRefresh()}}}else c.value="finished"};e.onReachBottom((()=>{"投稿"===m.value?g.hasMore&&!g.isRefreshing&&R():"活动"===m.value?v.hasMore&&!v.isRefreshing&&j():"收藏"===m.value?f.hasMore&&!f.isRefreshing&&M():"喜欢"===m.value&&x.hasMore&&!x.isRefreshing&&k()})),e.onPullDownRefresh((()=>{"投稿"===m.value?R(!0):"活动"===m.value?j(!0):"收藏"===m.value?M(!0):"喜欢"===m.value&&k(!0)})),e.watch((()=>m.value),(e=>{c.value="loading","投稿"===e?R(!0):"活动"===e?j(!0):"收藏"===e?M(!0):"喜欢"===e&&k(!0)})),e.onShow((()=>{const e=a.getUserInfo();e&&(l.value=e,g.userId=e.id),"投稿"===m.value?R(!0):"活动"===m.value?j(!0):"收藏"===m.value?M(!0):"喜欢"===m.value&&k(!0)}));const _=e.ref(!1),z=()=>{_.value=!1},I=()=>{_.value=!0};e.onShareAppMessage((e=>(console.log(e),{title:"青春共享站",path:"/pages/index/index",imageUrl:"/static/logo.jpg"}))),e.onShareTimeline((()=>({title:"青春共享站",path:"/pages/index/index",imageUrl:"/static/logo.jpg"})));const C=e=>{const i=["success","primary","warning","danger"];return i[e%i.length]},S=e.computed((()=>{var e;return!!(null==(e=l.value)?void 0:e.id)})),T=()=>{S.value?e.index.navigateTo({url:"/pages/updateUserInfo/updateUserInfo"}):e.index.showModal({title:"提示",content:"登录后可查看更多信息",confirmText:"去登录",cancelText:"取消",success:i=>{i.confirm&&e.index.navigateTo({url:"/pages/login/login"})}})};return(i,a)=>{var o,n;return e.e({a:e.p({src:(null==(o=l.value)?void 0:o.imageUrl)||"/static/default-avatar.jpg",width:"88",height:"88",round:!0}),b:S.value},S.value?{c:e.p({name:"edit-outline",size:"12px",color:"#fff"})}:{},{d:e.t(S.value?l.value.userName:"未登录"),e:S.value},S.value?{f:e.p({name:"star",size:"14px",color:"#FFB52B"}),g:e.t((null==(n=l.value)?void 0:n.constellation)||"修仙熬夜座~")}:{},{h:!S.value},S.value?{i:e.t(l.value.id||"未设置")}:{},{j:e.o(T),k:S.value},S.value?{l:e.t(l.value.userProfile||"这个人很懒，简介都不想写，估计是没有对象吧"),m:e.f(l.value.tagList,((i,a,o)=>({a:e.t(i),b:a,c:"47ce31ba-3-"+o,d:e.p({type:C(a),size:"small",round:!0})})))}:{},{n:e.t(S.value?l.value.follows||0:"-"),o:e.o(T),p:e.t(S.value?l.value.fans||0:"-"),q:e.o(T),r:e.t(S.value?l.value.likes||0:"-"),s:e.o(T),t:S.value},S.value?{v:e.p({name:"setting",size:"20px",color:"#333"}),w:e.o(I)}:{},{x:e.p({title:"修改个人信息","title-width":"150px",icon:"edit-outline","is-link":!0,to:"/pages/updateUserInfo/updateUserInfo"}),y:e.p({title:"反馈中心","title-width":"150px",icon:"cloud-upload","is-link":!0,to:"/pages/feedback/feedback"}),z:e.p({title:"联系我们","title-width":"150px",icon:"call","is-link":!0,to:"/pages/relation/relation"}),A:e.p({border:!0}),B:e.o(z),C:e.o((e=>_.value=e)),D:e.p({position:"left","custom-style":"height:100vh;width:70%",modelValue:_.value}),E:e.o((e=>m.value=e)),F:e.p({options:p.value,value:m.value}),G:"投稿"===m.value},"投稿"===m.value?e.e({H:!S.value},S.value?{I:e.f(u.value,((i,a,o)=>e.e({a:e.t(i.createTime.split("T")[0]),b:e.t(i.content),c:0!=i.imagesList.length},0!=i.imagesList.length?{d:e.f(i.imagesList.slice(0,3),((a,t,n)=>e.e({a:"47ce31ba-11-"+o+"-"+n,b:e.p({width:"100%",height:"100%",mode:"aspectFill",radius:"5px",src:a}),c:2===t&&i.imagesList.length>3},2===t&&i.imagesList.length>3?{d:e.t(i.imagesList.length-3)}:{},{e:t,f:2===t?1:""}))),e:1===i.imagesList.length?1:""}:{},{f:e.f(i.tags,((i,a,t)=>({a:e.t(i),b:i,c:"47ce31ba-12-"+o+"-"+t}))),g:"47ce31ba-13-"+o,h:e.t(i.viewCount),i:i.isLike},i.isLike?{j:"47ce31ba-14-"+o,k:e.p({"class-prefix":"t-icon",name:"like-selected"})}:{l:"47ce31ba-15-"+o,m:e.p({"class-prefix":"t-icon",name:"like"})},{n:e.t(i.likeCount),o:"47ce31ba-16-"+o,p:e.t(i.commentCount),q:a}))),J:l.value.imageUrl,K:e.t(l.value.userName),L:e.p({type:"primary",plain:!0,mark:!0}),M:e.p({name:"view",size:"16px"}),N:e.p({name:"chat",size:"16px"})}:{}):{},{O:"活动"===m.value},"活动"===m.value?{P:e.f(d.value,((i,a,o)=>({a:i.coverPicture,b:e.t(e.unref(t.getActivityStatus)(null==i?void 0:i.status)),c:e.t(i.title),d:"47ce31ba-17-"+o,e:e.t(i.endTime),f:"47ce31ba-18-"+o,g:e.t(i.position),h:a,i:e.o((i=>(i=>{console.log("点击活动详情");const a=JSON.stringify(d.value[i]);e.index.navigateTo({url:"/pages/activityDetail/activityDetail?activityInfo="+a})})(a)),a)}))),Q:e.p({name:"time"}),R:e.p({name:"location"})}:{},{S:"收藏"===m.value},"收藏"===m.value?e.e({T:0===h.value.length},(h.value.length,{})):{},{U:"喜欢"===m.value},"喜欢"===m.value?e.e({V:0===w.value.length},(w.value.length,{}),{W:e.f(w.value,((a,o,t)=>e.e({a:"47ce31ba-19-"+t,b:e.p({src:a.userVO.imageUrl,width:45,height:45,round:!0,mode:"scaleToFill"}),c:e.t(a.userVO.userName),d:e.t(a.createTime),e:e.o((i=>{return o=a.userVO.id,console.log("id",o),void e.index.navigateTo({url:`/pages/userDetail/userDetail?userId=${o}`});var o}),o),f:"47ce31ba-20-"+t,g:e.p({text:a.content,color:"#565756",size:"14px",lines:4}),h:e.o((e=>L(a.id)),o),i:null!=a.imagesList},null!=a.imagesList?{j:e.f(a.imagesList.slice(0,9),((o,n,s)=>e.e({a:"47ce31ba-22-"+t+"-"+s+",47ce31ba-21-"+t+"-"+s,b:e.o((e=>i.previewImage(o,a.imagesList)),n),c:"47ce31ba-21-"+t+"-"+s,d:e.p({width:"100%",height:"100%",mode:"aspectFill","show-menu-by-longpress":!0,radius:"5px",src:o}),e:8===n&&a.imagesList.length>9},8===n&&a.imagesList.length>9?{f:e.t(a.imagesList.length-9)}:{},{g:n}))),k:e.o((e=>L(a.id)),o),l:e.n(b(a.imagesList.length))}:{},{m:"47ce31ba-23-"+t,n:e.t(a.viewCount),o:a.isLike},(a.isLike,{}),{p:e.t(a.likeCount),q:e.o((e=>i.handleLikeItem(a.id,o)),o),r:"47ce31ba-24-"+t,s:e.t(a.commentCount),t:e.o((e=>L(a.id)),o),v:"47ce31ba-26-"+t+",47ce31ba-25-"+t,w:e.o((e=>i.link(a.id)),o),x:"47ce31ba-25-"+t,y:e.o(((...e)=>i.closeOutside&&i.closeOutside(...e)),o),z:o}))),X:e.p({name:"view",size:"16px"}),Y:e.p({name:"chat",size:"16px"}),Z:e.p({name:"more",size:"16px"}),aa:e.p({mode:"menu",content:i.menu})}):{},{ab:e.o(y),ac:e.p({"custom-class":"loadmore",state:c.value,"loading-text":"别急在跑了...","finished-text":"已经没有啦~","error-text":"与火星断联了~，点击重试"})})}}});s.__runtimeHooks=6;const l=e._export_sfc(s,[["__scopeId","data-v-47ce31ba"]]);wx.createPage(l);
