"use strict";const e=require("../../common/vendor.js"),o=require("../../api/articleApi.js"),n=require("../../uni_modules/wot-design-uni/components/wd-toast/index.js");require("../../uni_modules/wot-design-uni/locale/index.js");const s=require("../../api/uploadApi.js");if(!Array){(e.resolveComponent("wd-navbar")+e.resolveComponent("wd-notice-bar")+e.resolveComponent("wd-textarea")+e.resolveComponent("wd-upload")+e.resolveComponent("wd-tag")+e.resolveComponent("wd-icon")+e.resolveComponent("wd-cell")+e.resolveComponent("wd-cell-group")+e.resolveComponent("wd-gap")+e.resolveComponent("wd-button")+e.resolveComponent("wd-action-sheet")+e.resolveComponent("wd-toast"))()}Math||((()=>"../../uni_modules/wot-design-uni/components/wd-navbar/wd-navbar.js")+(()=>"../../uni_modules/wot-design-uni/components/wd-notice-bar/wd-notice-bar.js")+(()=>"../../uni_modules/wot-design-uni/components/wd-textarea/wd-textarea.js")+(()=>"../../uni_modules/wot-design-uni/components/wd-upload/wd-upload.js")+(()=>"../../uni_modules/wot-design-uni/components/wd-tag/wd-tag.js")+(()=>"../../uni_modules/wot-design-uni/components/wd-icon/wd-icon.js")+(()=>"../../uni_modules/wot-design-uni/components/wd-cell/wd-cell.js")+(()=>"../../uni_modules/wot-design-uni/components/wd-cell-group/wd-cell-group.js")+(()=>"../../uni_modules/wot-design-uni/components/wd-gap/wd-gap.js")+(()=>"../../uni_modules/wot-design-uni/components/wd-button/wd-button.js")+(()=>"../../uni_modules/wot-design-uni/components/wd-action-sheet/wd-action-sheet.js")+(()=>"../../uni_modules/wot-design-uni/components/wd-toast/wd-toast.js"))();const t=e.defineComponent({__name:"publishArticle",setup(t){const l=n.useToast(),a=e.ref([]),i=e.ref(!1),u=e.ref({content:"",tags:[],images:[]}),c=e.ref([]),d=()=>{e.index.navigateBack()},p=()=>{o.getArticleTags().then((e=>{c.value=e.data.map((e=>({name:e}))),console.log(c.value)})),i.value=!i.value},r=e=>{console.log(u.value.tags),u.value.tags.push(e.item.name)},g=e=>{console.log("上传成功res",e.file.response);const o=JSON.parse(e.file.response);console.log("上传成功result.data",o.data),u.value.images.push(...o.data),console.log(u.value)},m=e=>{console.log("files:",e),console.log(a.value),a.value=e},w=e=>{const o=u.value.images[e.index];console.log("删除前置处理",o),s.deleteFile(o).then((o=>{200===o.code?(console.log("删除成功",o),a.value.splice(e.index,1),u.value.images.splice(e.index,1),console.log("publishArticleParams>>>",u)):console.log("删除失败",o)}))},v=()=>{l.show("暂不支持哦~")},h=()=>{l.show("暂不支持哦~")},x=e.lodashExports.debounce((async()=>{e.index.showLoading({title:"加载中",mask:!0}),console.log("发布文章参数：",u.value);const n=await o.addArticle(u.value);200==n.code?(l.show({msg:"发布成功，等待审核~",cover:!0}),setTimeout((()=>{const o=getCurrentPages().find((e=>"pages/index/index"===e.route));o&&o.$vm.setNeedRefresh(),e.index.switchTab({url:"/pages/index/index"})}),1500)):l.error(n.message)}),500);return e.onShareAppMessage((e=>(console.log(e),{title:"青春共享站",path:"/pages/index/index",imageUrl:"/static/logo.jpg"}))),e.onShareTimeline((()=>({title:"青春共享站",path:"/pages/index/index",imageUrl:"/static/logo.jpg"}))),(o,n)=>e.e({a:e.o(d),b:e.p({title:"写说说",leftText:"取消",fixed:!0,placeholder:!0,safeAreaInsetTop:!0}),c:e.p({text:"帖子发布公告：帖子内容禁止有关任何政治立场、色情、暴力等一系列非法言论，如有发现将封禁发布功能",prefix:"check-outline",color:"#34D19D","background-color":"#f0f9eb","custom-class":"space"}),d:e.o((e=>u.value.content=e)),e:e.p({maxlength:2e3,"show-word-limit":!0,placeholderStyle:"font-size:18px;","show-count":!0,clearable:!0,placeholder:"分享新鲜事~",size:"large",rows:5,modelValue:u.value.content}),f:e.sr("uploadFile","1b2e36a9-3"),g:e.o(m),h:e.o(g),i:e.o((e=>a.value=e)),j:e.p({limit:9,multiple:!0,accept:"image",action:"https://campus.fybreeze.cn/api/article/uploadImages","before-remove":w,"file-list":a.value}),k:0!=u.value.tags.length},0!=u.value.tags.length?{l:e.f(u.value.tags,((o,n,s)=>({a:e.t(o),b:e.o((e=>(e=>{u.value.tags.splice(e,1)})(n))),c:"1b2e36a9-4-"+s}))),m:e.p({closable:!0,round:!0,type:"primary"})}:{},{n:e.p({round:!0,"bg-color":"#eee"}),o:e.p({name:"discount"}),p:e.o(p),q:e.p({"custom-class":"space",round:!0,"use-icon-slot":!0,"bg-color":"#eee"}),r:e.p({name:"location"}),s:e.p({"custom-class":"space",round:!0,"use-icon-slot":!0,"bg-color":"#eee"}),t:e.o(h),v:e.p({title:"谁可以看","is-link":!0,icon:"view",value:"所有人可见"}),w:e.o(v),x:e.p({title:"定时","is-link":!0,icon:"clock"}),y:e.p({height:"60px"}),z:e.o(e.unref(x)),A:e.p({block:!0,type:"primary"}),B:e.o(r),C:e.o((e=>!i.value)),D:e.o((e=>i.value=e)),E:e.p({actions:c.value,"cancel-text":"取消",modelValue:i.value})})}});t.__runtimeHooks=6;const l=e._export_sfc(t,[["__scopeId","data-v-1b2e36a9"]]);wx.createPage(l);
