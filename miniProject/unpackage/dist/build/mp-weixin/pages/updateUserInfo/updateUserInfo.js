"use strict";const e=require("../../common/vendor.js"),l=require("../../utils/userStorage.js"),o=require("../../api/userApi.js"),a=require("../../uni_modules/wot-design-uni/components/wd-toast/index.js");require("../../uni_modules/wot-design-uni/locale/index.js");const n=require("../../api/uploadApi.js");if(!Array){(e.resolveComponent("wd-navbar")+e.resolveComponent("wd-img")+e.resolveComponent("wd-icon")+e.resolveComponent("wd-button")+e.resolveComponent("wd-input")+e.resolveComponent("wd-cell")+e.resolveComponent("wd-select-picker")+e.resolveComponent("wd-textarea")+e.resolveComponent("wd-gap")+e.resolveComponent("wd-toast"))()}Math||((()=>"../../uni_modules/wot-design-uni/components/wd-navbar/wd-navbar.js")+(()=>"../../uni_modules/wot-design-uni/components/wd-img/wd-img.js")+(()=>"../../uni_modules/wot-design-uni/components/wd-icon/wd-icon.js")+(()=>"../../uni_modules/wot-design-uni/components/wd-button/wd-button.js")+(()=>"../../uni_modules/wot-design-uni/components/wd-input/wd-input.js")+(()=>"../../uni_modules/wot-design-uni/components/wd-cell/wd-cell.js")+(()=>"../../uni_modules/wot-design-uni/components/wd-select-picker/wd-select-picker.js")+(()=>"../../uni_modules/wot-design-uni/components/wd-textarea/wd-textarea.js")+(()=>"../../uni_modules/wot-design-uni/components/wd-gap/wd-gap.js")+(()=>"../../uni_modules/wot-design-uni/components/wd-toast/wd-toast.js"))();const s=e.defineComponent({__name:"updateUserInfo",setup(s){const t=a.useToast(),u=e.ref({tagList:[]}),r=e.ref(""),i=e.ref([{value:0,label:"男"},{value:1,label:"女"},{value:2,label:"保密"}]),d=e.ref([{value:"熬夜冠军座",label:"熬夜冠军座"},{value:"秃然焦虑座",label:"秃然焦虑座"},{value:"奶茶续命座",label:"奶茶续命座"},{value:"地铁迷路座",label:"地铁迷路座"},{value:"社畜进化座",label:"社畜进化座"},{value:"通宵赶工座",label:"通宵赶工座"},{value:"表情包王座",label:"表情包王座"},{value:"社恐晚期座",label:"社恐晚期座"},{value:"香菜毁灭座",label:"香菜毁灭座"},{value:"锦鲤附体座",label:"锦鲤附体座"},{value:"电量焦虑座",label:"电量焦虑座"}]),c=e.ref([{value:"运动达人",label:"运动达人"},{value:"学习狂魔",label:"学习狂魔"},{value:"社交达人",label:"社交达人"},{value:"文艺青年",label:"文艺青年"},{value:"技术宅",label:"技术宅"},{value:"美食家",label:"美食家"},{value:"旅行者",label:"旅行者"},{value:"音乐控",label:"音乐控"},{value:"电影迷",label:"电影迷"},{value:"摄影师",label:"摄影师"},{value:"创意咖",label:"创意咖"},{value:"志愿者",label:"志愿者"}]);e.onLoad((()=>{u.value=l.getUserInfo(),console.log(u.value)}));const v=()=>{e.index.navigateBack()},p=e=>{u.value.constellation=e.value,console.log(u.value),console.log(e)},m=async()=>{console.log(u.value);const a={id:u.value.id,imageUrl:u.value.imageUrl,userName:u.value.userName,userProfile:u.value.userProfile,gender:u.value.gender,constellation:u.value.constellation,tagList:u.value.tagList};if(r.value){200===(await n.deleteFile(r.value)).code?console.log("删除旧图片成功"):console.log("删除旧图片失败")}const s=await o.updateWxUser(a);200===s.code?(t.show("更新成功"),u.value={...s.data,...u.value},l.clearUserInfo(),console.log("user-value:",u.value),l.setUserInfo(u.value),console.log("getuserinfo",l.getUserInfo()),setTimeout((()=>{e.index.navigateBack()}),1e3)):t.show(s.message)},g=l=>{var o;console.log("选择头像:",l);const a=(null==(o=l.detail)?void 0:o.avatarUrl)||l.avatarUrl;a?(e.index.showLoading({title:"上传中..."}),e.index.uploadFile({url:"https://campus.fybreeze.cn/api/article/uploadImages",filePath:a,name:"file",formData:{user:"test"},success(e){var l,o;try{const a=JSON.parse(e.data);200===a.code&&(null==(l=a.data)?void 0:l[0])?(r.value=(null==(o=u.value)?void 0:o.imageUrl)||"",u.value.imageUrl=a.data[0],t.show("上传成功")):t.error("上传失败："+(a.message||"未知错误"))}catch(a){console.error("解析响应失败:",a),t.error("上传失败：数据格式错误")}},fail(e){console.error("上传失败:",e),t.error("上传失败："+(e.errMsg||"网络错误"))},complete(){e.index.hideLoading()}})):t.error("获取头像失败")},w=e=>{console.log(e)};return e.onShareAppMessage((e=>(console.log(e),{title:"青春共享站",path:"/pages/index/index",imageUrl:"/static/logo.jpg"}))),e.onShareTimeline((()=>({title:"青春共享站",path:"/pages/index/index",imageUrl:"/static/logo.jpg"}))),(l,o)=>{var a,n;return e.e({a:e.o(v),b:e.p({"custom-class":"navbar",bordered:!1,title:"修改信息",safeAreaInsetTop:!0,"left-arrow":!0}),c:null==(a=u.value)?void 0:a.imageUrl},(null==(n=u.value)?void 0:n.imageUrl)?{d:e.p({width:100,height:100,round:!0,src:u.value.imageUrl})}:{e:e.p({name:"person",size:"50px",color:"#acc4f9"})},{f:e.p({name:"camera",size:"20px",color:"#fff"}),g:e.o(g),h:e.p({"custom-class":"userAvatar",type:"text","open-type":"chooseAvatar"}),i:e.o(w),j:e.o((e=>u.value.userName=e)),k:e.p({type:"nickname","no-border":!0,placeholder:"请输入用户名",modelValue:u.value.userName}),l:e.p({title:"昵称",center:!0}),m:e.o(p),n:e.o((e=>u.value.gender=e)),o:e.p({type:"radio",label:"性别",columns:i.value,modelValue:u.value.gender}),p:e.o(p),q:e.o((e=>u.value.constellation=e)),r:e.p({type:"radio",label:"星座",columns:d.value,modelValue:u.value.constellation}),s:e.o((e=>u.value.tagList=e)),t:e.p({label:"标签",prop:"tagList",type:"checkbox",max:3,columns:c.value,placeholder:"请选择个性标签",modelValue:u.value.tagList}),v:e.o((e=>u.value.userProfile=e)),w:e.p({label:"简介",clearable:!0,placeholder:"请输入简介","show-word-limit":!0,maxlength:100,modelValue:u.value.userProfile}),x:e.o(m),y:e.p({"custom-class":"btn",block:!0,type:"primary"}),z:e.p({height:"60rpx"})})}}});s.__runtimeHooks=6;const t=e._export_sfc(s,[["__scopeId","data-v-909c0f01"]]);wx.createPage(t);
