"use strict";const e=require("../../../../common/vendor.js"),t=require("../common/util.js"),n=require("./types.js");Math||a();const a=()=>"../wd-picker-view/wd-picker-view.js",r=e.defineComponent({name:"wd-datetime-picker-view",virtualHost:!0,addGlobalClass:!0,styleIsolation:"shared",props:n.datetimePickerViewProps,emits:["change","pickstart","pickend","update:modelValue"],setup(a,{expose:r,emit:o}){const u=(e,t)=>32-new Date(e,t-1,32).getDate(),i=a,m=o,l=e.ref(),c=e.ref(null),s=e.ref([]),p=e.ref([]),d=e.ref(!1),{proxy:g}=e.getCurrentInstance();r({updateColumns:h,setColumns:function(e){s.value=e},getSelects:function(){var e;const n=null==(e=l.value)?void 0:e.getSelects();return null==n?void 0:t.isArray(n)?n:[n]},correctValue:b,getPickerValue:n.getPickerValue,getOriginColumns:v,...i});const f=t.debounce((()=>{if(!d.value)return;const e=b(i.modelValue);e===c.value?s.value=h():M(e)}),50);function y({value:e}){p.value=e;const n=function(){var e;const{type:n}=i;let a="";const r=(null==(e=l.value)?void 0:e.getValues())||[],o=t.isArray(r)?r:[r];if("time"===n)return a=`${t.padZero(o[0])}:${t.padZero(o[1])}`,a;const m=o[0]&&parseInt(o[0]),c="year"===n?1:o[1]&&parseInt(o[1]),s=u(Number(m),Number(c));let p=1;"year-month"!==n&&"year"!==n&&(p=(Number(o[2])&&parseInt(String(o[2])))>s?s:o[2]&&parseInt(String(o[2])));let d=0,g=0;"datetime"===n&&(d=Number(o[3])&&parseInt(o[3]),g=Number(o[4])&&parseInt(o[4]));const f=new Date(Number(m),Number(c)-1,Number(p),d,g).getTime();return a=b(f),a}();m("update:modelValue",n),m("change",{value:n,picker:g.$.exposed})}function h(){const{formatter:e,columnFormatter:n}=i;return n?n(g.$.exposed):v().map((n=>n.values.map((a=>({label:e?e(n.type,t.padZero(a)):t.padZero(a),value:a})))))}function v(){const{filter:e}=i;return function(){if("time"===i.type)return[{type:"hour",range:[i.minHour,i.maxHour]},{type:"minute",range:[i.minMinute,i.maxMinute]}];const{maxYear:e,maxDate:t,maxMonth:n,maxHour:a,maxMinute:r}=x("max",c.value),{minYear:o,minDate:u,minMonth:m,minHour:l,minMinute:s}=x("min",c.value),p=[{type:"year",range:[o,e]},{type:"month",range:[m,n]},{type:"date",range:[u,t]},{type:"hour",range:[l,a]},{type:"minute",range:[s,r]}];"date"===i.type&&p.splice(3,2);"year-month"===i.type&&p.splice(2,3);"year"===i.type&&p.splice(1,4);return p}().map((({type:t,range:n})=>{let a=((e,t)=>{let n=-1;const a=Array(e<0?0:e);for(;++n<e;)a[n]=t(n);return a})(n[1]-n[0]+1,(e=>n[0]+e));return e&&(a=e(t,a)),{type:t,values:a}}))}function b(e){const n="time"!==i.type;var a;if(n&&(a=e,!t.isDef(a)||Number.isNaN(a))?e=i.minDate:n||e||(e=`${t.padZero(i.minHour)}:00`),!n){let[n,a]=e.split(":");return n=t.padZero(t.range(Number(n),i.minHour,i.maxHour)),a=t.padZero(t.range(Number(a),i.minMinute,i.maxMinute)),`${n}:${a}`}return e=Math.min(Math.max(Number(e),i.minDate),i.maxDate)}function x(e,t){const n=new Date(t),a=new Date(i[`${e}Date`]),r=a.getFullYear();let o=1,m=1,l=0,c=0;return"max"===e&&(o=12,m=u(n.getFullYear(),n.getMonth()+1),l=23,c=59),n.getFullYear()===r&&(o=a.getMonth()+1,n.getMonth()+1===o&&(m=a.getDate(),n.getDate()===m&&(l=a.getHours(),n.getHours()===l&&(c=a.getMinutes())))),{[`${e}Year`]:r,[`${e}Month`]:o,[`${e}Date`]:m,[`${e}Hour`]:l,[`${e}Minute`]:c}}function M(e){const t=n.getPickerValue(e,i.type);i.modelValue!==e&&(m("update:modelValue",e),m("change",{value:e,picker:g.$.exposed})),c.value=e,s.value=h(),p.value=t}function w(e){if("time"===i.type||"year-month"===i.type||"year"===i.type)return;const t=e.getValues(),n=Number(t[0]),a=Number(t[1]),r=u(n,a);let o=Number(t[2]);o=o>r?r:o;let m=0,l=0;"datetime"===i.type&&(m=Number(t[3]),l=Number(t[4]));const s=new Date(n,a-1,o,m,l).getTime();c.value=b(s);const p=h(),d=e.getSelectedIndex().slice(0);p.forEach(((t,n)=>{const a=n+1,r=p[a];a>p.length-1||e.setColumnData(a,r,d[a]<=r.length-1?d[a]:0)}))}function D(){m("pickstart")}function N(){m("pickend")}return e.watch((()=>i.modelValue),((e,t)=>{if(e===t)return;M(b(e))}),{deep:!0,immediate:!0}),e.watch((()=>i.type),(e=>{const t=["date","year-month","time","datetime","year"];-1===t.indexOf(e)&&console.error(`type must be one of ${t}`),f()}),{deep:!0,immediate:!0}),e.watch((()=>i.filter),(e=>{e&&!t.isFunction(e)&&console.error("The type of filter must be Function"),f()}),{deep:!0,immediate:!0}),e.watch((()=>i.formatter),(e=>{e&&!t.isFunction(e)&&console.error("The type of formatter must be Function"),f()}),{deep:!0,immediate:!0}),e.watch((()=>i.columnFormatter),(e=>{e&&!t.isFunction(e)&&console.error("The type of columnFormatter must be Function"),f()}),{deep:!0,immediate:!0}),e.watch([()=>i.minDate,()=>i.maxDate,()=>i.minHour,()=>i.maxHour,()=>i.minMinute,()=>i.minMinute,()=>i.maxMinute],(()=>{f()}),{deep:!0,immediate:!0}),e.onBeforeMount((()=>{d.value=!0;M(b(i.modelValue))})),(t,n)=>({a:e.sr(l,"c4a1d57f-0",{k:"datePickerview"}),b:e.o(y),c:e.o(D),d:e.o(N),e:e.o((e=>p.value=e)),f:e.p({"custom-class":t.customClass,"custom-style":t.customStyle,"immediate-change":t.immediateChange,columns:s.value,"columns-height":t.columnsHeight,columnChange:w,loading:t.loading,"loading-color":t.loadingColor,modelValue:p.value})})}}),o=e._export_sfc(r,[["__scopeId","data-v-c4a1d57f"]]);wx.createComponent(o);
