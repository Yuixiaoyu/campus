"use strict";const e=require("../../../../common/vendor.js"),a=require("../common/util.js"),l=require("../composables/useCell.js"),t=require("../wd-datetime-picker-view/types.js"),r=require("../wd-form/types.js"),u=require("../composables/useParent.js"),o=require("../composables/useTranslate.js"),n=require("./types.js"),i=require("../common/dayjs.js");if(!Array){e.resolveComponent("wd-icon")()}Math||((()=>"../wd-icon/wd-icon.js")+d+s)();const s=()=>"../wd-popup/wd-popup.js",d=()=>"../wd-datetime-picker-view/wd-datetime-picker-view.js",c=e.defineComponent({name:"wd-datetime-picker",options:{virtualHost:!0,addGlobalClass:!0,styleIsolation:"shared"},props:n.datetimePickerProps,emits:["change","open","toggle","cancel","confirm","update:modelValue"],setup(n,{expose:s,emit:d}){const c=n,m=d,{translate:v}=o.useTranslate("datetime-picker"),p=e.ref(),f=e.ref(),y=e.ref(""),h=e.ref(!1),b=e.ref(!0),g=e.ref(!1),C=e.ref([]),w=e.ref(""),k=e.ref(""),_=e.ref(!1),V=e.ref(!1),x=e.ref(!1),{proxy:$}=e.getCurrentInstance(),F=l.useCell();e.watch((()=>c.modelValue),((l,t)=>{a.isEqual(l,t)||(a.isArray(l)?(g.value=!0,w.value=a.deepClone(P(!0)),k.value=a.deepClone(P(!0,!0))):w.value=a.deepClone(P()),e.nextTick$1((()=>{E(!1,!1,!0)})))}),{deep:!0,immediate:!0}),e.watch((()=>c.displayFormat),(e=>{e&&!a.isFunction(e)&&console.error("The type of displayFormat must be Function")}),{deep:!0,immediate:!0}),e.watch((()=>c.filter),(e=>{e&&!a.isFunction(e)&&console.error("The type of filter must be Function")}),{deep:!0,immediate:!0}),e.watch((()=>c.formatter),(e=>{e&&!a.isFunction(e)&&console.error("The type of formatter must be Function")}),{deep:!0,immediate:!0}),e.watch((()=>c.beforeConfirm),(e=>{e&&!a.isFunction(e)&&console.error("The type of beforeConfirm must be Function")}),{deep:!0,immediate:!0}),e.watch((()=>c.displayFormatTabLabel),(e=>{e&&!a.isFunction(e)&&console.error("The type of displayFormatTabLabel must be Function")}),{deep:!0,immediate:!0}),e.watch((()=>c.defaultValue),(e=>{a.isArray(e)||g.value?(w.value=a.deepClone(P(!0)),k.value=a.deepClone(P(!0,!0))):w.value=a.deepClone(P())}),{deep:!0,immediate:!0});const{parent:j}=u.useParent(r.FORM_KEY),T=e.computed((()=>j&&c.prop&&j.errorMessages&&j.errorMessages[c.prop]?j.errorMessages[c.prop]:"")),q=e.computed((()=>{let e=!1;if(j&&j.props.rules){const a=j.props.rules;for(const l in a)Object.prototype.hasOwnProperty.call(a,l)&&l===c.prop&&Array.isArray(a[l])&&(e=a[l].some((e=>e.required)))}return c.required||c.rules.some((e=>e.required))||e})),S=e=>{if(!e)return[];const{type:l}=c,{startSymbol:t,formatter:r}=e,u=e.correctValue(w.value),o=e.correctValue(k.value),n=t?e.getPickerValue(u,l):e.getPickerValue(o,l),i=t?e.getPickerValue(o,l):e.getPickerValue(u,l),s=e.getOriginColumns();return s.map(((e,l)=>e.values.map((u=>{const o=function(e,a,l,t,r,u){const{type:o}=c,n=a[l];if("datetime"===o){const a=u[0],l=u[1],o=u[2],i=u[3],s=u[4];if("year"===n.type)return e?t>a:t<a;if("month"===n.type&&r[0]===a)return e?t>l:t<l;if("date"===n.type&&r[0]===a&&r[1]===l)return e?t>o:t<o;if("hour"===n.type&&r[0]===a&&r[1]===l&&r[2]===o)return e?t>i:t<i;if("minute"===n.type&&r[0]===a&&r[1]===l&&r[2]===o&&r[3]===i)return e?t>s:t<s}else if("year-month"===o){const a=u[0],l=u[1];if("year"===n.type)return e?t>a:t<a;if("month"===n.type&&r[0]===a)return e?t>l:t<l}else if("year"===o){const a=u[0];if("year"===n.type)return e?t>a:t<a}else if("date"===o){const a=u[0],l=u[1],o=u[2];if("year"===n.type)return e?t>a:t<a;if("month"===n.type&&r[0]===a)return e?t>l:t<l;if("date"===n.type&&r[0]===a&&r[1]===l)return e?t>o:t<o}else if("time"===o){const a=u[0],l=u[1];if("hour"===n.type)return e?t>a:t<a;if("minute"===n.type&&r[0]===a)return e?t>l:t<l}return!1}(t,s,l,u,n,i);return{label:r?r(e.type,a.padZero(u)):a.padZero(u),value:u,disabled:o}}))))};function A(e){let l="before"===e?w.value:k.value,r=[];return l&&(r=t.getPickerValue(l,c.type)),r.map((e=>({[c.labelKey]:a.padZero(e),[c.valueKey]:e})))}function M(){}function P(e,l){const{modelValue:t,defaultValue:r,maxDate:u,minDate:o,type:n}=c;if(e){const e=l?1:0,s=a.isArray(t)?t[e]:"",d=a.isArray(r)?r[e]:"",c="time"===n?i.dayjs(u).format("HH:mm"):u,m="time"===n?i.dayjs(o).format("HH:mm"):o;return s||d||(l?c:m)}return a.isDef(t||r)?t||r:""}function H(){c.disabled||c.readonly||(m("open"),g.value?(h.value=!0,b.value=!0,w.value=a.deepClone(P(!0,!1)),k.value=a.deepClone(P(!0,!0))):(h.value=!0,w.value=a.deepClone(P())),E(!0,!1,!0))}function D(){b.value=!b.value;const e=b.value?p.value:f.value;e.setColumns(e.updateColumns()),m("toggle",b.value?w.value:k.value)}function L({value:e}){w.value=a.deepClone(e),g.value?(C.value=[Z(),a.deepClone(C.value[1])],m("change",{value:[e,k.value]}),p.value&&p.value.setColumns(p.value.updateColumns()),f.value&&f.value.setColumns(f.value.updateColumns())):m("change",{value:w.value})}function K({value:e}){k.value=a.deepClone(e),C.value=[a.deepClone(C.value[0]),Z(1)],m("change",{value:[w.value,e]}),p.value&&p.value.setColumns(p.value.updateColumns()),f.value&&f.value.setColumns(f.value.updateColumns())}function I(){h.value=!1,setTimeout((()=>{g.value?(w.value=a.deepClone(P(!0)),k.value=a.deepClone(P(!0,!0))):w.value=a.deepClone(P())}),200),m("cancel")}function O(){if(c.loading||x.value)return;if(_.value)return void(V.value=!0);const{beforeConfirm:e}=c;e?e(g.value?[w.value,k.value]:w.value,(e=>{e&&W()}),$.$.exposed):W()}function z(){_.value=!0}function B(){_.value=!1,setTimeout((()=>{V.value&&(V.value=!1,O())}),50)}function W(){if(c.loading||x.value||c.disabled)return void(h.value=!1);const e=g.value?[w.value,k.value]:w.value;h.value=!1,m("update:modelValue",e),m("confirm",{value:e}),E(!1,!0)}function Z(e=0){if(g.value){let a=[];return a=0===e?(p.value?p.value.getSelects():void 0)||w.value&&A("before"):(f.value?f.value.getSelects():void 0)||k.value&&A("after"),R(a,!0)}return""}function E(e=!1,l=!1,t=!1){if(g.value){const a=t?w.value&&A("before")||[]:p.value&&p.value.getSelects&&p.value.getSelects()||[],r=t?k.value&&A("after")||[]:f.value&&f.value.getSelects&&f.value.getSelects()||[];y.value=e?y.value:[c.modelValue[0]||l?R(a):"",c.modelValue[1]||l?R(r):""],C.value=[R(a,!0),R(r,!0)]}else{const e=t?w.value&&A("before")||[]:p.value&&p.value.getSelects&&p.value.getSelects()||[];y.value=a.deepClone(c.modelValue||l?R(e):"")}}function R(e,a=!1){if(0===e.length)return"";if(a&&c.displayFormatTabLabel)return c.displayFormatTabLabel(e);if(c.displayFormat)return c.displayFormat(e);if(c.formatter){const a={year:["year"],datetime:["year","month","date","hour","minute"],date:["year","month","date"],time:["hour","minute"],"year-month":["year","month"]};return e.map(((e,l)=>c.formatter(a[c.type][l],e.value))).join("")}switch(c.type){case"year":return e[0].label;case"date":return`${e[0].label}-${e[1].label}-${e[2].label}`;case"year-month":return`${e[0].label}-${e[1].label}`;case"time":return`${e[0].label}:${e[1].label}`;case"datetime":return`${e[0].label}-${e[1].label}-${e[2].label} ${e[3].label}:${e[4].label}`}}return e.onBeforeMount((()=>{const{modelValue:e}=c;a.isArray(e)?(g.value=!0,w.value=a.deepClone(P(!0)),k.value=a.deepClone(P(!0,!0))):w.value=a.deepClone(P())})),e.onMounted((()=>{E(!1,!1,!0)})),s({open:function(){H()},close:function(){I()},setLoading:function(e){x.value=e}}),(l,t)=>e.e({a:l.useDefaultSlot},l.useDefaultSlot?{}:e.e({b:l.label||l.useLabelSlot},l.label||l.useLabelSlot?e.e({c:l.label},l.label?{d:e.t(l.label)}:{},{e:e.n(`wd-picker__label ${l.customLabelClass} ${q.value?"is-required":""}`),f:e.s(l.labelWidth?"min-width:"+l.labelWidth+";max-width:"+l.labelWidth+";":"")}):{},{g:g.value},g.value?e.e({h:e.unref(a.isArray)(y.value)},e.unref(a.isArray)(y.value)?{i:e.t(y.value[0]?y.value[0]:l.placeholder||e.unref(v)("placeholder")),j:e.n(y.value[0]?"":"wd-picker__placeholder"),k:e.t(e.unref(v)("to")),l:e.t(y.value[1]?y.value[1]:l.placeholder||e.unref(v)("placeholder")),m:e.n(y.value[1]?"":"wd-picker__placeholder")}:{n:e.t(l.placeholder||e.unref(v)("placeholder"))}):{o:e.t(y.value?y.value:l.placeholder||e.unref(v)("placeholder")),p:e.n(y.value?"":"wd-picker__placeholder")},{q:e.n(`wd-picker__value ${l.customValueClass}`),r:!l.disabled&&!l.readonly},l.disabled||l.readonly?{}:{s:e.p({"custom-class":"wd-picker__arrow",name:"arrow-right"})},{t:T.value},T.value?{v:e.t(T.value)}:{},{w:e.n(l.customCellClass)}),{x:e.o(H),y:e.t(l.cancelButtonText||e.unref(v)("cancel")),z:e.o(I),A:l.title},l.title?{B:e.t(l.title)}:{},{C:e.t(l.confirmButtonText||e.unref(v)("confirm")),D:e.n("wd-picker__action "+(l.loading||x.value?"is-loading":"")),E:e.o(O),F:e.o(M),G:g.value},g.value?{H:e.t(e.unref(v)("start")),I:e.t(C.value[0]),J:e.n(`wd-picker__region ${b.value?"is-active":""} `),K:e.o(D),L:e.t(e.unref(v)("end")),M:e.t(C.value[1]),N:e.n("wd-picker__region "+(b.value?"":"is-active")),O:e.o(D)}:{},{P:e.sr(p,"216d77c1-2,216d77c1-1",{k:"datetimePickerView"}),Q:e.o(L),R:e.o(z),S:e.o(B),T:e.o((e=>w.value=e)),U:e.p({"custom-class":l.customViewClass,type:l.type,loading:l.loading||x.value,"loading-color":l.loadingColor,"columns-height":l.columnsHeight,"value-key":l.valueKey,"label-key":l.labelKey,formatter:l.formatter,filter:l.filter,"column-formatter":e.unref(a.isArray)(l.modelValue)?S:void 0,"max-hour":l.maxHour,"min-hour":l.minHour,"max-date":l.maxDate,"min-date":l.minDate,"max-minute":l.maxMinute,"min-minute":l.minMinute,"start-symbol":!0,"immediate-change":l.immediateChange,modelValue:w.value}),V:e.n(b.value?"wd-picker__show":"wd-picker__hidden"),W:e.sr(f,"216d77c1-3,216d77c1-1",{k:"datetimePickerView1"}),X:e.o(K),Y:e.o(z),Z:e.o(B),aa:e.o((e=>k.value=e)),ab:e.p({"custom-class":l.customViewClass,type:l.type,loading:l.loading||x.value,"loading-color":l.loadingColor,"columns-height":l.columnsHeight,"value-key":l.valueKey,"label-key":l.labelKey,formatter:l.formatter,filter:l.filter,"column-formatter":e.unref(a.isArray)(l.modelValue)?S:void 0,"max-hour":l.maxHour,"min-hour":l.minHour,"max-date":l.maxDate,"min-date":l.minDate,"max-minute":l.maxMinute,"min-minute":l.minMinute,"start-symbol":!1,"immediate-change":l.immediateChange,modelValue:k.value}),ac:e.n(b.value?"wd-picker__hidden":"wd-picker__show"),ad:e.o(I),ae:e.o((e=>h.value=e)),af:e.p({position:"bottom","hide-when-close":!1,"close-on-click-modal":l.closeOnClickModal,"safe-area-inset-bottom":l.safeAreaInsetBottom,"z-index":l.zIndex,"custom-class":"wd-picker__popup",modelValue:h.value}),ag:e.n(`wd-picker ${l.disabled?"is-disabled":""} ${l.size?"is-"+l.size:""}  ${e.unref(F).border.value?"is-border":""} ${l.alignRight?"is-align-right":""} ${l.error?"is-error":""} ${l.customClass}`),ah:e.s(l.customStyle)})}}),m=e._export_sfc(c,[["__scopeId","data-v-216d77c1"]]);wx.createComponent(m);
