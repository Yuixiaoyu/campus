"use strict";const e=require("../../../../common/vendor.js"),s=require("../common/util.js"),o=require("../composables/useChildren.js"),r=require("../wd-toast/index.js"),t=require("./types.js");Math||a();const a=()=>"../wd-toast/wd-toast.js",p=e.defineComponent({name:"wd-form",options:{addGlobalClass:!0,virtualHost:!0,styleIsolation:"shared"},props:t.formProps,setup(a,{expose:p}){const{show:n}=r.useToast("wd-form-toast"),i=a,{children:c,linkChildren:l}=o.useChildren(t.FORM_KEY);let m=e.reactive({});function u(e){e?m[e]="":Object.keys(m).forEach((e=>{m[e]=""}))}return l({props:i,errorMessages:m}),e.watch((()=>i.model),(()=>{i.resetOnChange&&u()}),{immediate:!0,deep:!0}),p({validate:async function(e){const o=[];let r=!0;const t=[],a=function(){const e=s.deepClone(i.rules),o=c.map((e=>e.prop));return Object.keys(e).forEach((s=>{o.includes(s)||delete e[s]})),c.forEach((o=>{s.isDef(o.prop)&&s.isDef(o.rules)&&o.rules.length&&(e[o.prop]?e[o.prop]=[...e[o.prop],...o.rules]:e[o.prop]=o.rules)})),e}(),p=s.isArray(e)?e:s.isDef(e)?[e]:[],l=p.length>0?p.reduce(((e,s)=>(a[s]&&(e[s]=a[s]),e)),{}):a;for(const n in l){const e=l[n],a=s.getPropByPath(i.model,n);if(e&&e.length>0)for(const p of e){if(p.required&&(!s.isDef(a)||""===a)){o.push({prop:n,message:p.message}),r=!1;break}if(p.pattern&&!p.pattern.test(a)){o.push({prop:n,message:p.message}),r=!1;break}const{validator:e,...i}=p;if(e){const c=e(a,i);s.isPromise(c)?t.push(c.then((e=>{"string"==typeof e?(o.push({prop:n,message:e}),r=!1):"boolean"!=typeof e||e||(o.push({prop:n,message:p.message}),r=!1)})).catch((e=>{const t=s.isDef(e)?s.isString(e)?e:e.message||p.message:p.message;o.push({prop:n,message:t}),r=!1}))):c||(o.push({prop:n,message:p.message}),r=!1)}}}return await Promise.all(t),function(e){const s=c.map((e=>e.prop)).filter(Boolean),o=e.filter((e=>e.message&&s.includes(e.prop)));o.length&&(o.sort(((e,o)=>s.indexOf(e.prop)-s.indexOf(o.prop))),"toast"===i.errorType?n(o[0].message):"message"===i.errorType&&o.forEach((e=>{m[e.prop]=e.message})))}(o),r&&(p.length?p.forEach(u):u()),{valid:r,errors:o}},reset:function(){u()}}),(s,o)=>e.e({a:"toast"===i.errorType},"toast"===i.errorType?{b:e.p({selector:"wd-form-toast"})}:{},{c:e.n(`wd-form ${s.customClass}`),d:e.s(s.customStyle)})}}),n=e._export_sfc(p,[["__scopeId","data-v-176a1352"]]);wx.createComponent(n);
