"use strict";const e=require("../../../../common/vendor.js"),l=require("../composables/useCell.js"),a=require("../common/util.js"),o=require("../composables/useParent.js"),r=require("../wd-form/types.js"),t=require("../composables/useTranslate.js"),s=require("./types.js");if(!Array){(e.resolveComponent("wd-icon")+e.resolveComponent("wd-search"))()}Math||((()=>"../wd-icon/wd-icon.js")+(()=>"../wd-search/wd-search.js")+c+u+n+d+v+p+i)();const i=()=>"../wd-action-sheet/wd-action-sheet.js",c=()=>"../wd-checkbox/wd-checkbox.js",u=()=>"../wd-checkbox-group/wd-checkbox-group.js",n=()=>"../wd-radio/wd-radio.js",d=()=>"../wd-radio-group/wd-radio-group.js",p=()=>"../wd-button/wd-button.js",v=()=>"../wd-loading/wd-loading.js",m=e.defineComponent({name:"wd-select-picker",options:{addGlobalClass:!0,virtualHost:!0,styleIsolation:"shared"},props:s.selectPickerProps,emits:["change","cancel","confirm","clear","update:modelValue","open","close"],setup(s,{expose:i,emit:c}){const{translate:u}=t.useTranslate("select-picker"),n=s,d=c,p=e.ref(!1),v=e.ref([]),m=e.ref(!1),f=e.ref([]),b=e.ref(""),h=e.ref([]),y=e.ref(0),w=l.useCell(),g=e.computed((()=>{const e=K(n.modelValue);let l="";if(n.displayFormat)l=n.displayFormat(e,n.columns);else{const{type:o,labelKey:r}=n;if("checkbox"===o){l=(a.isArray(e)?e:[]).map((e=>j(e))).map((e=>e[r])).join(", ")}else if("radio"===o){l=j(e)[r]}else l=e}return l}));e.watch((()=>n.modelValue),(e=>{e!==v.value&&(v.value=K(e),f.value=K(e))}),{deep:!0,immediate:!0}),e.watch((()=>n.columns),(e=>{n.filterable&&b.value?P(e,b.value):h.value=e}),{deep:!0,immediate:!0}),e.watch((()=>n.displayFormat),(e=>{e&&!a.isFunction(e)&&console.error("The type of displayFormat must be Function")}),{deep:!0,immediate:!0}),e.watch((()=>n.beforeConfirm),(e=>{e&&!a.isFunction(e)&&console.error("The type of beforeConfirm must be Function")}),{deep:!0,immediate:!0});const{parent:k}=o.useParent(r.FORM_KEY),x=e.computed((()=>k&&n.prop&&k.errorMessages&&k.errorMessages[n.prop]?k.errorMessages[n.prop]:"")),_=e.computed((()=>{let e=!1;if(k&&k.props.rules){const l=k.props.rules;for(const a in l)Object.prototype.hasOwnProperty.call(l,a)&&a===n.prop&&Array.isArray(l[a])&&(e=l[a].some((e=>e.required)))}return n.required||n.rules.some((e=>e.required))||e}));e.onBeforeMount((()=>{v.value=K(n.modelValue),h.value=n.columns}));const{proxy:C}=e.getCurrentInstance();function $(){}function j(e){const{valueKey:l,labelKey:a,columns:o}=n,r=o.filter((a=>a[l]===e));return r.length>0?r[0]:{[l]:e,[a]:""}}function K(e){return"checkbox"===n.type?a.isArray(e)?e:[]:e}function A({value:e}){v.value=e,d("change",{value:e}),"radio"!==n.type||n.showConfirm||z()}function V(){p.value=!1,m.value||(v.value=K(f.value)),d("cancel"),d("close")}function q(){n.disabled||n.readonly||(v.value=K(n.modelValue),p.value=!0,m.value=!1,d("open"))}function z(){if(n.loading)return p.value=!1,d("confirm"),void d("close");n.beforeConfirm?n.beforeConfirm(v.value,(e=>{e&&F()})):F()}function F(){m.value=!0,p.value=!1,f.value=K(v.value);let e={};e="checkbox"===n.type?(a.isArray(f.value)?f.value:[]).map((e=>j(e))):j(f.value),d("update:modelValue",f.value),d("confirm",{value:f.value,selectedItems:e}),d("close")}function I(e,l){const a=new RegExp(`(${l})`,"g");return e.split(a).map((e=>({type:e===l?"active":"normal",label:e})))}function M({value:l}){""===l?(h.value=[],b.value=l,e.nextTick$1((()=>{h.value=n.columns}))):(b.value=l,P(n.columns,l))}function P(l,a){const o=l.filter((e=>e[n.labelKey].indexOf(a)>-1)).map((e=>({...e,[n.labelKey]:I(e[n.labelKey],a)})));h.value=[],e.nextTick$1((()=>{h.value=o}))}const T=e.computed((()=>"radio"===n.type&&n.showConfirm||"checkbox"===n.type)),R=e.computed((()=>n.clearable&&!n.disabled&&!n.readonly&&g.value.length));function S(){d("update:modelValue","checkbox"===n.type?[]:""),d("clear")}const D=e.computed((()=>!n.disabled&&!n.readonly&&!R.value));return i({close:V,open:q}),(l,o)=>e.e({a:l.useDefaultSlot},l.useDefaultSlot?{}:e.e({b:l.label||l.useLabelSlot},l.label||l.useLabelSlot?e.e({c:l.label},l.label?{d:e.t(l.label)}:{},{e:e.n(`wd-select-picker__label ${_.value&&"is-required"} ${l.customLabelClass}`),f:e.s(l.labelWidth?"min-width:"+l.labelWidth+";max-width:"+l.labelWidth+";":"")}):{},{g:e.t(g.value||l.placeholder||e.unref(u)("placeholder")),h:e.n(`wd-select-picker__value ${l.ellipsis&&"is-ellipsis"} ${l.customValueClass} ${g.value?"":"wd-select-picker__value--placeholder"}`),i:D.value},D.value?{j:e.p({"custom-class":"wd-select-picker__arrow",name:"arrow-right"})}:R.value?{l:e.p({"custom-class":"wd-select-picker__clear",name:"error-fill"}),m:e.o(S)}:{},{k:R.value,n:x.value},x.value?{o:e.t(x.value)}:{},{p:e.n(`wd-select-picker__cell ${l.disabled&&"is-disabled"} ${l.readonly&&"is-readonly"} ${l.alignRight&&"is-align-right"} ${l.error&&"is-error"} ${l.size&&"is-"+l.size}`)}),{q:e.o(q),r:l.filterable},l.filterable?{s:e.o(M),t:e.o((e=>b.value=e)),v:e.p({placeholder:l.filterPlaceholder||e.unref(u)("filterPlaceholder"),"hide-cancel":!0,"placeholder-left":!0,modelValue:b.value})}:{},{w:"checkbox"===l.type&&e.unref(a.isArray)(v.value)},"checkbox"===l.type&&e.unref(a.isArray)(v.value)?{x:e.f(h.value,((a,o,r)=>e.e(l.filterable&&b.value?{a:e.f(a[l.labelKey],((l,a,o)=>e.e({a:"active"===l.type},"active"===l.type?{b:e.t(l.label)}:{c:e.t(l.label)},{d:l.label})))}:{b:e.t(a[l.labelKey])},{c:"f69480a4-5-"+r+",f69480a4-4",d:e.p({modelValue:a[l.valueKey],disabled:a.disabled}),e:a[l.valueKey],f:"check"+a[l.valueKey]}))),y:l.filterable&&b.value,z:e.o(A),A:e.o((e=>v.value=e)),B:e.p({cell:!0,size:l.selectSize,"checked-color":l.checkedColor,min:l.min,max:l.max,modelValue:v.value})}:{},{C:"radio"===l.type&&!e.unref(a.isArray)(v.value)},"radio"!==l.type||e.unref(a.isArray)(v.value)?{}:{D:e.f(h.value,((a,o,r)=>e.e(l.filterable&&b.value?{a:e.f(a[l.labelKey],((l,a,o)=>({a:e.t(l.label),b:e.n(""+("active"===l.type?"wd-select-picker__text-active":"")),c:l.label})))}:{b:e.t(a[l.labelKey])},{c:"f69480a4-7-"+r+",f69480a4-6",d:e.p({value:a[l.valueKey],disabled:a.disabled}),e:o,f:"radio"+a[l.valueKey]}))),E:l.filterable&&b.value,F:e.o(A),G:e.o((e=>v.value=e)),H:e.p({cell:!0,size:l.selectSize,"checked-color":l.checkedColor,modelValue:v.value})},{I:l.loading},l.loading?{J:e.p({color:l.loadingColor}),K:e.o($)}:{},{L:e.n(`wd-select-picker__wrapper ${l.filterable?"is-filterable":""} ${l.loading?"is-loading":""} ${l.customContentClass}`),M:!l.loading,N:y.value,O:T.value},T.value?{P:e.t(l.confirmButtonText||e.unref(u)("confirm")),Q:e.o(z),R:e.p({block:!0,size:"large",disabled:l.loading})}:{},{S:e.o(V),T:e.o((o=>l.scrollIntoView?async function(){let l="",o=[];a.isDef(v.value)&&""!==v.value&&!a.isArray(v.value)?(l="#wd-radio-group",o=[a.getRect(`#radio${v.value}`,!1,C)]):a.isArray(v.value)&&v.value.length>0&&(v.value.forEach((e=>{o.push(a.getRect(`#check${e}`,!1,C))})),l="#wd-checkbox-group"),l&&(await a.pause(2e3/30),Promise.all([a.getRect(".wd-select-picker__wrapper",!1,C),a.getRect(l,!1,C),...o]).then((l=>{if(a.isDef(l)&&a.isArray(l)){const o=l[0],r=l[1],t=l.slice(2)||[];a.isDef(r)&&a.isDef(o)&&t.findIndex((e=>e.bottom>o.top&&e.top<o.bottom))<0&&(y.value=-1,e.nextTick$1((()=>{y.value=Math.max(0,t[0].top-r.top-o.height/2)})))}})))}():"")),U:e.o((e=>p.value=e)),V:e.p({duration:250,title:l.title||e.unref(u)("title"),"close-on-click-modal":l.closeOnClickModal,"z-index":l.zIndex,"safe-area-inset-bottom":l.safeAreaInsetBottom,"custom-header-class":"wd-select-picker__header",modelValue:p.value}),W:e.n(`wd-select-picker ${e.unref(w).border.value?"is-border":""} ${l.customClass}`),X:e.s(l.customStyle)})}}),f=e._export_sfc(m,[["__scopeId","data-v-f69480a4"]]);wx.createComponent(f);
