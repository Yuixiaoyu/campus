"use strict";const e=require("../../../../common/vendor.js"),t=require("../common/util.js"),o=require("../common/props.js"),s=require("./types.js"),i=require("../composables/useChildren.js");Math||n();const n=()=>"../wd-resize/wd-resize.js",r=e.defineComponent({name:"wd-sticky-box",options:{addGlobalClass:!0,styleIsolation:"shared"},props:o.baseProps,setup(o){const n=o,r=e.ref(`wd-sticky-box${t.uuid()}`),c=e.ref(new Map),a=e.reactive({height:0,width:0}),{proxy:u}=e.getCurrentInstance(),{children:l,linkChildren:d}=i.useChildren(s.STICKY_BOX_KEY);function h(e){a.width=e.width,a.height=e.height;const t=c.value;c.value=new Map;for(const[o]of t){p(l.find((e=>e.$.uid===o)))}t.forEach((e=>{e.disconnect()})),t.clear()}function p(o){!function(e){const t=c.value.get(e.$.uid);t&&(t.disconnect(),c.value.delete(e.$.uid))}(o);const s=function(t){const o=e.index.createIntersectionObserver(u,{thresholds:[0,.5]});return c.value.set(t.$.uid,o),o}(o),i=o.$.exposed;let n=i.stickyState.height+i.offsetTop;a.height<=i.stickyState.height&&i.setPosition(!1,"absolute",0),s.relativeToViewport({top:-n}).observe(`#${r.value}`,(e=>{f(i,e)})),t.getRect(`#${r.value}`,!1,u).then((e=>{Number(e.bottom)<=n&&f(i,{boundingClientRect:e})})).catch((e=>{console.log(e)}))}function f(e,{boundingClientRect:t}){let o=e.offsetTop;const s=e.stickyState.height+o;let i=t.bottom<=s;if(i)e.setPosition(!0,"absolute",t.height-e.stickyState.height);else if(t.top<=s&&!i){if("normal"===e.stickyState.state)return;e.setPosition(!1,"fixed",o)}}return d({boxStyle:a,observerForChild:p}),e.onBeforeMount((()=>{c.value=new Map})),(t,o)=>({a:e.o(h),b:e.n(`wd-sticky-box ${n.customClass}`),c:e.s(t.customStyle),d:r.value})}}),c=e._export_sfc(r,[["__scopeId","data-v-e2455409"]]);wx.createComponent(c);
