"use strict";const e=require("../../../../common/vendor.js"),t=require("../common/util.js"),o=require("./types.js"),i=require("../composables/useParent.js"),s=require("../wd-sticky-box/types.js");Math||n();const n=()=>"../wd-resize/wd-resize.js",r=e.defineComponent({name:"wd-sticky",options:{addGlobalClass:!0,virtualHost:!0,styleIsolation:"shared"},props:o.stickyProps,setup(o,{expose:n}){const r=o,a=e.ref(`wd-sticky${t.uuid()}`),d=e.ref([]),u=e.reactive({position:"absolute",boxLeaved:!1,top:0,height:0,width:0,state:""}),{parent:c}=i.useParent(s.STICKY_BOX_KEY),{proxy:p}=e.getCurrentInstance(),l=e.computed((()=>{const e={"z-index":r.zIndex,height:t.addUnit(u.height),width:t.addUnit(u.width)};return u.boxLeaved||(e.position="relative"),`${t.objToStyle(e)};${r.customStyle}`})),h=e.computed((()=>{const e={"z-index":r.zIndex,height:t.addUnit(u.height),width:t.addUnit(u.width)};return u.boxLeaved||(e.position="relative"),`${t.objToStyle(e)};`})),v=e.computed((()=>{const e={position:u.position,top:t.addUnit(u.top)};return t.objToStyle(e)})),b=e.computed((()=>0+r.offsetTop));async function f(o){u.width=o.width,u.height=o.height,await t.pause(),function(){if(0===u.height&&0===u.width)return;const o=b.value+u.height;(function(){for(;0!==d.value.length;)d.value.pop().disconnect()})(),function(){const t=e.index.createIntersectionObserver(p,{thresholds:[0,.5]});return d.value.push(t),t}().relativeToViewport({top:-o}).observe(`#${a.value}`,(e=>{y(e)})),t.getRect(`#${a.value}`,!1,p).then((e=>{Number(e.bottom)<=o&&y({boundingClientRect:e})}))}(),c&&c.observerForChild&&c.observerForChild(p)}function y({boundingClientRect:e}){if(c&&u.height>=c.boxStyle.height)return u.position="absolute",void(u.top=0);e.top<=b.value?(u.state="sticky",u.boxLeaved=!1,u.position="fixed",u.top=b.value):(u.state="normal",u.boxLeaved=!1,u.position="absolute",u.top=0)}return n({setPosition:function(e,t,o){u.boxLeaved=e,u.position=t,u.top=o},stickyState:u,offsetTop:r.offsetTop}),(t,o)=>({a:e.o(f),b:e.p({"custom-style":"display: inline-block;"}),c:e.s(v.value),d:e.n(`wd-sticky ${t.customClass}`),e:e.s(h.value),f:a.value,g:e.s(`${l.value};display: inline-block;`)})}}),a=e._export_sfc(r,[["__scopeId","data-v-fd927823"]]);wx.createComponent(a);
