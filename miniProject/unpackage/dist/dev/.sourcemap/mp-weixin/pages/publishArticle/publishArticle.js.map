{"version":3,"file":"publishArticle.js","sources":["pages/publishArticle/publishArticle.vue","D:/HBuilderX/HBuilderX.3.1.22.20210709.full/HBuilderX/plugins/uniapp-cli-vite/uniPage:/cGFnZXMvcHVibGlzaEFydGljbGUvcHVibGlzaEFydGljbGUudnVl"],"sourcesContent":["<template>\n  <view class=\"publish-article\">\n    <!-- 顶部导航栏 -->\n    <wd-navbar title=\"写说说\" leftText=\"取消\" fixed placeholder safeAreaInsetTop @click-left=\"onClickLeft\">\n    </wd-navbar>\n\n    <!-- 主体内容区域 -->\n    <view class=\"content\">\n      <view class=\"upload-section\">\n        <!-- 文本输入区域 -->\n        <wd-textarea\n            v-model=\"publishArticleParams.content\"\n            :maxlength=\"2000\"\n            show-word-limit\n            placeholderStyle=\"font-size:18px;\"\n            show-count\n            clearable\n            placeholder=\"分享新鲜事~\"\n            size=\"large\"\n            :rows=\"5\"\n        />\n\n        <!-- 图片上传区域 -->\n        <wd-upload\n            v-model:file-list=\"fileList\"\n            ref=\"uploadFile\"\n            :limit=\"9\"\n            multiple\n            accept=\"image\"\n            action=\"http://localhost:8090/api/article/uploadImages\"\n            @change=\"handleChange\"\n            :before-remove=\"beforeImageRemove\"\n            @success=\"uploadSuccess\"\n        >\n        </wd-upload>\n\n\n        <view class=\"tags\" v-if=\"publishArticleParams.tags.length!=0\">\n          <wd-tag closable round type=\"primary\" v-for=\"(item,index) in publishArticleParams.tags\" @close=\"handleSelectedClose(index)\">\n            {{ item }}\n          </wd-tag>\n        </view>\n\n        <view class=\"lable\">\n          &nbsp;&nbsp;\n          <wd-tag round bg-color=\"#eee\">@ 好友</wd-tag>\n          &nbsp;\n          <wd-tag custom-class=\"space\" round use-icon-slot bg-color=\"#eee\" @click=\"showAction\">\n            <text>添加标签</text>\n            <template #icon>\n              <wd-icon name=\"discount\"></wd-icon>\n            </template>\n          </wd-tag>\n          &nbsp;\n          <wd-tag custom-class=\"space\" round use-icon-slot bg-color=\"#eee\">\n            <text>添加地点</text>\n            <template #icon>\n              <wd-icon name=\"location\"></wd-icon>\n            </template>\n          </wd-tag>\n        </view>\n        <view>\n        </view>\n      </view>\n\n      <!-- 位置和可见范围设置 -->\n      <view class=\"settings\">\n        <wd-cell-group>\n          <wd-cell title=\"谁可以看\" is-link icon=\"view\" value=\"所有人可见\" @click=\"setVisibility\"/>\n          <wd-cell title=\"定时\" is-link icon=\"clock\" @click=\"setTime\"/>\n          <wd-cell title=\"匿名\" center icon=\"note\">\n            <view class=\"custom-value\" style=\"height: 32px;\">\n              <wd-switch v-model=\"isAnonymity\" @change=\"handleAnonymityChange\"/>\n            </view>\n          </wd-cell>\n        </wd-cell-group>\n      </view>\n    </view>\n    <wd-gap height=\"60px\"></wd-gap>\n\n    <!-- 底部发布按钮 -->\n    <view class=\"footer\">\n      <wd-button block type=\"primary\" @click=\"publishArticle\">\n        发布笔记\n      </wd-button>\n    </view>\n\n    <!-- 动作面板 -->\n    <wd-action-sheet v-model=\"showActionSheet\" :actions=\"actions\" @select=\"selectAction\" @close=\"!showActionSheet\"\n                     cancel-text=\"取消\"/>\n    <wd-toast />\n  </view>\n</template>\n\n<script setup lang=\"ts\">\nimport {ref} from 'vue'\nimport {addArticle, AddArticleParams, getArticleTags} from \"@/api/articleApi\";\nimport { useToast } from '@/uni_modules/wot-design-uni'\n\nconst toast = useToast()\n// 数据定义\nconst fileList = ref([])\n// 是否匿名\nconst isAnonymity = ref(false)\n// 动作面板\nconst showActionSheet = ref(false)\n//发布文章对象\nconst publishArticleParams = ref<AddArticleParams>({\n  content:'',\n  tags:[],\n  images:[],\n})\n\n// 动作面板数据\nconst actions = ref([])\n\n// 方法定义\nconst onClickLeft = () => {\n  uni.navigateBack()\n}\n\n\nconst getTags = () => {\n  getArticleTags().then((res: any) => {\n    actions.value = res.data.map(item => ({name: item}))\n    uni.__f__('log','at pages/publishArticle/publishArticle.vue:126',actions.value)\n  });\n}\n\n// 删除已选的tag\nconst handleSelectedClose = (index) => {\n  publishArticleParams.value.tags.splice(index,1)\n}\n\n// 点击添加标签按钮\nconst showAction = () => {\n  getTags()\n  showActionSheet.value = !showActionSheet.value\n}\n\nconst selectAction = (item) => {\n  uni.__f__('log','at pages/publishArticle/publishArticle.vue:142',publishArticleParams.value.tags)\n  publishArticleParams.value.tags.push(item.item.name)\n}\n\n// 匿名按钮\nconst handleAnonymityChange = () => {\n  isAnonymity.value = !isAnonymity.value\n}\n\n// 上传图片\nconst uploadSuccess = (res) => {\n  uni.__f__('log','at pages/publishArticle/publishArticle.vue:153','上传成功res', res.file.response)\n  const result = JSON.parse(res.file.response)\n  uni.__f__('log','at pages/publishArticle/publishArticle.vue:155','上传成功result.data', result.data)\n  // images.value.push(...result.data)\n  publishArticleParams.value.images.push(...result.data)\n  uni.__f__('log','at pages/publishArticle/publishArticle.vue:158',publishArticleParams.value)\n}\n//上传图片列表\nconst handleChange = ((file) => {\n  uni.__f__('log','at pages/publishArticle/publishArticle.vue:162',\"files:\", file)\n  uni.__f__('log','at pages/publishArticle/publishArticle.vue:163',fileList.value)\n  fileList.value = file;\n})\n\n// 删除图片前置操作\nconst beforeImageRemove = ((res) => {\n  fileList.value.splice(res.index, 1)\n  // images.value.splice(res.index, 1)\n  publishArticleParams.value.images.splice(res.index,1)\n  uni.__f__('log','at pages/publishArticle/publishArticle.vue:172',\"publishArticleParams>>>\",publishArticleParams)\n})\nconst setTime = () => {\n  // 实现定时发布\n}\n\nconst setVisibility = () => {\n  // 谁可见\n}\n\nconst publishArticle = async () => {\n  // 实现发布逻辑\n  uni.__f__('log','at pages/publishArticle/publishArticle.vue:184',\"发布文章参数：\", publishArticleParams.value)\n  const res = await addArticle(publishArticleParams.value)\n  uni.__f__('log','at pages/publishArticle/publishArticle.vue:186',\"发布文章接口返回结果：\", res)\n  if (res.code == 200) {\n    toast.show('发布成功')\n    setTimeout(() => {\n      uni.navigateBack()\n    }, 2000)\n  }else{\n    toast.error(res.message)\n  }\n}\n</script>\n\n<style lang=\"scss\" scoped>\n:deep(.wd-upload__mask.data-v-d50d9cde) {\n  background-color: rgba(0, 0, 0, 0.3);\n}\n\n.publish-article {\n  min-height: 100vh;\n  background-color: #f8f8f8;\n\n  .content {\n    padding: 16px;\n\n    .upload-section {\n      margin-bottom: 20px;\n      border-radius: 8px;\n      overflow: hidden;\n      background: #ffffff;\n\n      :deep(.wd-upload__preview) {\n        width: 100px;\n        height: 100px;\n      }\n\n      :deep(.data-v-d50d9cde.wd-upload__evoke) {\n        height: 100px;\n        width: 100px;\n        margin-left: 10px;\n        margin-bottom: 10px;\n        border-radius: 6px;\n      }\n\n      :deep(.wd-upload) {\n        padding: 10px;\n      }\n\n      :deep(.data-v-d50d9cde .wd-upload__preview) {\n        margin: 5px 6px;\n      }\n\n      .tags {\n        display: flex;\n        flex-wrap: wrap;\n        //justify-content: center;\n        padding: 8px 10px;\n\n        :deep(.wd-tag) {\n          margin: 6px 5px;\n        }\n      }\n\n      .lable {\n        margin-top: 10px;\n        margin-bottom: 20px;\n      }\n    }\n\n    .input-area {\n      margin-bottom: 20px;\n      background-color: #fff;\n      border-radius: 8px;\n\n      padding: 12px;\n    }\n\n    .tags-section {\n      display: flex;\n      flex-wrap: wrap;\n      gap: 8px;\n      margin-bottom: 20px;\n\n      .tag-item {\n        font-size: 12px;\n      }\n    }\n\n    .settings {\n      margin-bottom: 20px;\n      border-radius: 8px;\n      overflow: hidden;\n    }\n  }\n\n  .footer {\n    position: fixed;\n    bottom: 0;\n    left: 0;\n    right: 0;\n    padding: 16px;\n    background-color: #fff;\n  }\n\n  :deep(.wd-action-sheet) {\n    overflow: hidden;\n  }\n\n  :deep(.wd-action-sheet__actions) {\n    max-height: 200px;\n  }\n\n\n}\n\n\n</style>\n","import MiniProgramPage from 'G:/Code/campus/miniProject/pages/publishArticle/publishArticle.vue'\nwx.createPage(MiniProgramPage)"],"names":["useToast","ref","uni","getArticleTags","addArticle"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAmGA,UAAM,QAAQA,kDAAAA;AAER,UAAA,WAAWC,kBAAI,CAAA,CAAE;AAEjB,UAAA,cAAcA,kBAAI,KAAK;AAEvB,UAAA,kBAAkBA,kBAAI,KAAK;AAEjC,UAAM,uBAAuBA,cAAAA,IAAsB;AAAA,MACjD,SAAQ;AAAA,MACR,MAAK,CAAC;AAAA,MACN,QAAO,CAAC;AAAA,IAAA,CACT;AAGK,UAAA,UAAUA,kBAAI,CAAA,CAAE;AAGtB,UAAM,cAAc,MAAM;AACxBC,oBAAA,MAAI,aAAa;AAAA,IAAA;AAInB,UAAM,UAAU,MAAM;AACLC,oCAAA,EAAE,KAAK,CAAC,QAAa;AAC1B,gBAAA,QAAQ,IAAI,KAAK,IAAI,WAAS,EAAC,MAAM,KAAM,EAAA;AACnDD,sBAAA,MAAI,MAAM,OAAM,kDAAiD,QAAQ,KAAK;AAAA,MAAA,CAC/E;AAAA,IAAA;AAIG,UAAA,sBAAsB,CAAC,UAAU;AACrC,2BAAqB,MAAM,KAAK,OAAO,OAAM,CAAC;AAAA,IAAA;AAIhD,UAAM,aAAa,MAAM;AACf;AACQ,sBAAA,QAAQ,CAAC,gBAAgB;AAAA,IAAA;AAGrC,UAAA,eAAe,CAAC,SAAS;AAC7BA,oBAAA,MAAI,MAAM,OAAM,kDAAiD,qBAAqB,MAAM,IAAI;AAChG,2BAAqB,MAAM,KAAK,KAAK,KAAK,KAAK,IAAI;AAAA,IAAA;AAIrD,UAAM,wBAAwB,MAAM;AACtB,kBAAA,QAAQ,CAAC,YAAY;AAAA,IAAA;AAI7B,UAAA,gBAAgB,CAAC,QAAQ;AAC7BA,0BAAI,MAAM,OAAM,kDAAiD,WAAW,IAAI,KAAK,QAAQ;AAC7F,YAAM,SAAS,KAAK,MAAM,IAAI,KAAK,QAAQ;AAC3CA,oBAAA,MAAI,MAAM,OAAM,kDAAiD,mBAAmB,OAAO,IAAI;AAE/F,2BAAqB,MAAM,OAAO,KAAK,GAAG,OAAO,IAAI;AACrDA,oBAAA,MAAI,MAAM,OAAM,kDAAiD,qBAAqB,KAAK;AAAA,IAAA;AAGvF,UAAA,eAAgB,CAAC,SAAS;AAC9BA,oBAAA,MAAI,MAAM,OAAM,kDAAiD,UAAU,IAAI;AAC/EA,oBAAA,MAAI,MAAM,OAAM,kDAAiD,SAAS,KAAK;AAC/E,eAAS,QAAQ;AAAA,IAAA;AAIb,UAAA,oBAAqB,CAAC,QAAQ;AAClC,eAAS,MAAM,OAAO,IAAI,OAAO,CAAC;AAElC,2BAAqB,MAAM,OAAO,OAAO,IAAI,OAAM,CAAC;AACpDA,oBAAA,MAAI,MAAM,OAAM,kDAAiD,2BAA0B,oBAAoB;AAAA,IAAA;AAEjH,UAAM,UAAU,MAAM;AAAA,IAAA;AAItB,UAAM,gBAAgB,MAAM;AAAA,IAAA;AAI5B,UAAM,iBAAiB,YAAY;AAEjCA,oBAAA,MAAI,MAAM,OAAM,kDAAiD,WAAW,qBAAqB,KAAK;AACtG,YAAM,MAAM,MAAME,eAAAA,WAAW,qBAAqB,KAAK;AACvDF,oBAAA,MAAI,MAAM,OAAM,kDAAiD,eAAe,GAAG;AAC/E,UAAA,IAAI,QAAQ,KAAK;AACnB,cAAM,KAAK,MAAM;AACjB,mBAAW,MAAM;AACfA,wBAAA,MAAI,aAAa;AAAA,WAChB,GAAI;AAAA,MAAA,OACJ;AACG,cAAA,MAAM,IAAI,OAAO;AAAA,MACzB;AAAA,IAAA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AChMF,GAAG,WAAW,eAAe;"}