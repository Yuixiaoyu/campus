{"version":3,"file":"wd-fab.js","sources":["uni_modules/wot-design-uni/components/wd-fab/wd-fab.vue","D:/HBuilderX/HBuilderX.3.1.22.20210709.full/HBuilderX/plugins/uniapp-cli-vite/uniComponent:/RzovQ29kZS9jYW1wdXMvbWluaVByb2plY3QvdW5pX21vZHVsZXMvd290LWRlc2lnbi11bmkvY29tcG9uZW50cy93ZC1mYWIvd2QtZmFiLnZ1ZQ"],"sourcesContent":["<template>\n  <view\n    @touchmove.stop.prevent=\"handleTouchMove\"\n    @touchstart=\"handleTouchStart\"\n    @touchend=\"handleTouchEnd\"\n    :class=\"`wd-fab ${customClass}`\"\n    :style=\"rootStyle\"\n    @click.stop=\"\"\n  >\n    <view @click.stop=\"\" :style=\"{ visibility: inited ? 'visible' : 'hidden' }\" id=\"trigger\">\n      <slot name=\"trigger\" v-if=\"$slots.trigger\"></slot>\n      <wd-button v-else @click=\"handleClick\" custom-class=\"wd-fab__trigger\" round :type=\"type\" :disabled=\"disabled\">\n        <wd-icon custom-class=\"wd-fab__icon\" :name=\"isActive ? activeIcon : inactiveIcon\"></wd-icon>\n      </wd-button>\n    </view>\n    <wd-transition\n      v-if=\"expandable\"\n      :enter-class=\"`wd-fab__transition-enter--${fabDirection}`\"\n      enter-active-class=\"wd-fab__transition-enter-active\"\n      :leave-to-class=\"`wd-fab__transition-leave-to--${fabDirection}`\"\n      leave-active-class=\"wd-fab__transition-leave-active\"\n      :custom-class=\"`wd-fab__actions wd-fab__actions--${fabDirection}`\"\n      :show=\"isActive\"\n      :duration=\"300\"\n    >\n      <slot></slot>\n    </wd-transition>\n  </view>\n</template>\n\n<script lang=\"ts\">\nexport default {\n  name: 'wd-fab',\n  options: {\n    virtualHost: true,\n    addGlobalClass: true,\n    styleIsolation: 'shared'\n  }\n}\n</script>\n\n<script lang=\"ts\" setup>\nimport wdButton from '../wd-button/wd-button.vue'\nimport wdIcon from '../wd-icon/wd-icon.vue'\nimport wdTransition from '../wd-transition/wd-transition.vue'\nimport { type CSSProperties, computed, ref, watch, inject, getCurrentInstance, onBeforeUnmount, onMounted, nextTick } from 'vue'\nimport { getRect, isDef, isH5, objToStyle } from '../common/util'\nimport { type Queue, queueKey } from '../composables/useQueue'\nimport { closeOther, pushToQueue, removeFromQueue } from '../common/clickoutside'\nimport { fabProps, type FabExpose } from './types'\nimport { reactive } from 'vue'\nimport { useRaf } from '../composables/useRaf'\n\nconst props = defineProps(fabProps)\nconst emit = defineEmits(['update:active', 'click'])\nconst inited = ref<boolean>(false) // 是否初始化完成\nconst isActive = ref<boolean>(false) // 是否激活状态\nconst queue = inject<Queue | null>(queueKey, null)\nconst { proxy } = getCurrentInstance() as any\n\nwatch(\n  () => props.active,\n  (newValue) => {\n    isActive.value = newValue\n  },\n  { immediate: true, deep: true }\n)\n\nwatch(\n  () => isActive.value,\n  (newValue) => {\n    if (newValue) {\n      if (queue && queue.closeOther) {\n        queue.closeOther(proxy)\n      } else {\n        closeOther(proxy)\n      }\n    }\n  }\n)\n\nconst fabDirection = ref(props.direction)\n\nwatch(\n  () => props.direction,\n  (direction) => (fabDirection.value = direction)\n)\n\nwatch(\n  () => props.position,\n  () => initPosition()\n)\n\nconst top = ref<number>(0)\nconst left = ref<number>(0)\nconst screen = reactive({ width: 0, height: 0 })\nconst fabSize = reactive({ width: 56, height: 56 })\nconst bounding = reactive({\n  minTop: 0,\n  minLeft: 0,\n  maxTop: 0,\n  maxLeft: 0\n})\n\nasync function getBounding() {\n  const sysInfo = uni.getSystemInfoSync()\n  try {\n    const trigerInfo = await getRect('#trigger', false, proxy)\n    fabSize.width = trigerInfo.width || 56\n    fabSize.height = trigerInfo.height || 56\n  } catch (error) {\n    uni.__f__('log','at uni_modules/wot-design-uni/components/wd-fab/wd-fab.vue:112',error)\n  }\n\n  const { top = 16, left = 16, right = 16, bottom = 16 } = props.gap\n  screen.width = sysInfo.windowWidth\n  screen.height = isH5 ? sysInfo.windowTop + sysInfo.windowHeight : sysInfo.windowHeight\n  bounding.minTop = isH5 ? sysInfo.windowTop + top : top\n  bounding.minLeft = left\n  bounding.maxLeft = screen.width - fabSize.width - right\n  bounding.maxTop = screen.height - fabSize.height - bottom\n}\n\nfunction initPosition() {\n  const pos = props.position\n  const { minLeft, minTop, maxLeft, maxTop } = bounding\n  if (pos === 'left-top') {\n    top.value = minTop\n    left.value = minLeft\n  } else if (pos === 'right-top') {\n    top.value = minTop\n    left.value = maxLeft\n  } else if (pos === 'left-bottom') {\n    top.value = maxTop\n    left.value = minLeft\n  } else if (pos === 'right-bottom') {\n    top.value = maxTop\n    left.value = maxLeft\n  }\n}\n\n// 按下时坐标相对于元素的偏移量\nconst touchOffset = reactive({ x: 0, y: 0 })\nconst attractTransition = ref<boolean>(false)\nfunction handleTouchStart(e: TouchEvent) {\n  if (props.draggable === false) return\n\n  const touch = e.touches[0]\n  touchOffset.x = touch.clientX - left.value\n  touchOffset.y = touch.clientY - top.value\n  attractTransition.value = false\n}\n\nfunction handleTouchMove(e: TouchEvent) {\n  if (props.draggable === false) return\n\n  const touch = e.touches[0]\n  const { minLeft, minTop, maxLeft, maxTop } = bounding\n  let x = touch.clientX - touchOffset.x\n  let y = touch.clientY - touchOffset.y\n\n  if (x < minLeft) x = minLeft\n  else if (x > maxLeft) x = maxLeft\n\n  if (y < minTop) y = minTop\n  else if (y > maxTop) y = maxTop\n\n  top.value = y\n  left.value = x\n}\n\nfunction handleTouchEnd() {\n  if (props.draggable === false) return\n\n  const screenCenterX = screen.width / 2\n  const fabCenterX = left.value + fabSize.width / 2\n  attractTransition.value = true\n  if (fabCenterX < screenCenterX) {\n    left.value = bounding.minLeft\n    fabDirection.value = 'right'\n  } else {\n    left.value = bounding.maxLeft\n    fabDirection.value = 'left'\n  }\n}\n\nconst rootStyle = computed(() => {\n  const style: CSSProperties = {\n    top: top.value + 'px',\n    left: left.value + 'px',\n    transition: attractTransition.value ? 'all ease 0.3s' : 'none'\n  }\n  if (isDef(props.zIndex)) {\n    style['z-index'] = props.zIndex\n  }\n  return `${objToStyle(style)};${props.customStyle}`\n})\n\nonMounted(() => {\n  if (queue && queue.pushToQueue) {\n    queue.pushToQueue(proxy)\n  } else {\n    pushToQueue(proxy)\n  }\n\n  const { start } = useRaf(async () => {\n    await getBounding()\n    initPosition()\n    inited.value = true\n  })\n  start()\n})\n\nonBeforeUnmount(() => {\n  if (queue && queue.removeFromQueue) {\n    queue.removeFromQueue(proxy)\n  } else {\n    removeFromQueue(proxy)\n  }\n})\n\nfunction handleClick() {\n  if (props.disabled) {\n    return\n  }\n  if (!props.expandable) {\n    emit('click')\n    return\n  }\n  isActive.value = !isActive.value\n  emit('update:active', isActive.value)\n}\n\nfunction open() {\n  isActive.value = true\n  emit('update:active', true)\n}\n\nfunction close() {\n  isActive.value = false\n  emit('update:active', false)\n}\n\ndefineExpose<FabExpose>({\n  open,\n  close\n})\n</script>\n\n<style lang=\"scss\" scoped>\n@import './index.scss';\n</style>\n","import Component from 'G:/Code/campus/miniProject/uni_modules/wot-design-uni/components/wd-fab/wd-fab.vue'\nwx.createComponent(Component)"],"names":["ref","inject","queueKey","getCurrentInstance","watch","closeOther","reactive","uni","getRect","top","left","isH5","computed","isDef","objToStyle","onMounted","pushToQueue","useRaf","onBeforeUnmount","removeFromQueue"],"mappings":"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"}