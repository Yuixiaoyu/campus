{"version":3,"file":"wd-notice-bar.js","sources":["uni_modules/wot-design-uni/components/wd-notice-bar/wd-notice-bar.vue","D:/HBuilderX/HBuilderX.3.1.22.20210709.full/HBuilderX/plugins/uniapp-cli-vite/uniComponent:/RzovQ29kZS9jYW1wdXMvbWluaVByb2plY3QvdW5pX21vZHVsZXMvd290LWRlc2lnbi11bmkvY29tcG9uZW50cy93ZC1ub3RpY2UtYmFyL3dkLW5vdGljZS1iYXIudnVl"],"sourcesContent":["<template>\n  <view v-if=\"show\" :class=\"`wd-notice-bar ${customClass} ${noticeBarClass}`\" :style=\"rootStyle\">\n    <wd-icon v-if=\"prefix\" custom-class=\"wd-notice-bar__prefix\" :name=\"prefix\"></wd-icon>\n    <slot v-else name=\"prefix\"></slot>\n    <view class=\"wd-notice-bar__wrap\">\n      <view class=\"wd-notice-bar__content\" :style=\"animation\" @transitionend=\"animationEnd\" @click=\"handleClick\">\n        <template v-if=\"isVertical\">\n          <view v-for=\"item in textArray\" :key=\"item\">{{ item }}</view>\n          <view v-if=\"textArray.length > 1\">{{ textArray[0] }}</view>\n        </template>\n        <slot v-else>{{ currentText }}</slot>\n      </view>\n    </view>\n    <wd-icon v-if=\"closable\" custom-class=\"wd-notice-bar__suffix\" name=\"close-bold\" @click=\"handleClose\"></wd-icon>\n    <slot v-else name=\"suffix\"></slot>\n  </view>\n</template>\n<script lang=\"ts\">\nexport default {\n  name: 'wd-notice-bar',\n  options: {\n    virtualHost: true,\n    addGlobalClass: true,\n    styleIsolation: 'shared'\n  }\n}\n</script>\n\n<script lang=\"ts\" setup>\nimport wdIcon from '../wd-icon/wd-icon.vue'\nimport { ref, watch, nextTick, computed, getCurrentInstance, type CSSProperties, onMounted, onActivated, onDeactivated, reactive } from 'vue'\nimport { getRect, isArray, isDef, objToStyle } from '../common/util'\nimport { type NoticeBarExpose, noticeBarProps } from './types'\nconst $wrap = '.wd-notice-bar__wrap'\nconst $content = '.wd-notice-bar__content'\n\nconst props = defineProps(noticeBarProps)\nconst emit = defineEmits(['close', 'next', 'click'])\n\nconst wrapWidth = ref<number>(0)\nconst show = ref<boolean>(true)\nconst currentIndex = ref<number>(0)\nconst textArray = computed(() => (Array.isArray(props.text) ? props.text : [props.text]))\nconst currentText = computed(() => textArray.value[currentIndex.value])\nconst verticalIndex = ref<number>(0)\nconst wrapRect = ref<UniApp.NodeInfo | null>(null) // 外层容器节点信息\nconst contentRect = ref<UniApp.NodeInfo | null>(null) // 内容节点信息\nconst isHorizontal = computed(() => props.direction === 'horizontal')\nconst isVertical = computed(() => props.direction === 'vertical')\n\nconst transitionState = reactive<CSSProperties>({\n  transitionProperty: 'unset',\n  transitionDelay: 'unset',\n  transitionDuration: 'unset',\n  transform: 'none',\n  transitionTimingFunction: 'linear'\n})\n\nconst animation = computed(() => {\n  return objToStyle(transitionState)\n})\n\nconst rootStyle = computed(() => {\n  const style: CSSProperties = {}\n  if (isDef(props.color)) {\n    style.color = props.color\n  }\n\n  if (isDef(props.backgroundColor)) {\n    style.background = props.backgroundColor\n  }\n\n  return `${objToStyle(style)};${props.customStyle}`\n})\nconst noticeBarClass = computed(() => {\n  const { type, wrapable, scrollable } = props\n\n  let noticeBarClasses: string[] = []\n  type && noticeBarClasses.push(`is-${type}`)\n\n  if (isHorizontal.value) {\n    !wrapable && !scrollable && noticeBarClasses.push('wd-notice-bar--ellipse')\n  } else {\n    noticeBarClasses.push('wd-notice-bar--ellipse')\n  }\n\n  wrapable && !scrollable && noticeBarClasses.push('wd-notice-bar--wrap')\n  return noticeBarClasses.join(' ')\n})\n\nconst { proxy } = getCurrentInstance() as any\n\nwatch(\n  () => props.text,\n  () => {\n    reset()\n  },\n  { deep: true }\n)\n\nonMounted(() => {\n  startTransition()\n\n\n\n\n\n\n\n\n\n\n\n})\n\nonActivated(() => {\n  startTransition()\n})\n\nonDeactivated(() => {\n  stopTransition()\n})\n\nfunction reset() {\n  stopTransition()\n  startTransition()\n}\n\nfunction startTransition() {\n  nextTick(() => scroll())\n}\n\nfunction stopTransition() {\n  transitionState.transitionProperty = 'unset'\n  transitionState.transitionDelay = 'unset'\n  transitionState.transitionDuration = 'unset'\n  transitionState.transform = 'none'\n  transitionState.transitionTimingFunction = 'linear'\n  currentIndex.value = 0\n  verticalIndex.value = 0\n}\n\nfunction handleClose() {\n  show.value = false\n  emit('close')\n}\n\nfunction setTransition({ duration, delay, translate }: { duration: number; delay: number; translate: number }) {\n  transitionState.transitionProperty = 'all'\n  transitionState.transitionDelay = `${delay}s`\n  transitionState.transitionDuration = `${duration}s`\n  transitionState.transform = `${props.direction === 'vertical' ? 'translateY' : 'translateX'}(${translate}px)`\n  transitionState.transitionTimingFunction = 'linear'\n}\n\nfunction queryRect() {\n  return Promise.all([getRect($wrap, false, proxy), getRect($content, false, proxy)])\n}\n\nasync function verticalAnimate(height: number) {\n  const translate = -(height / (textArray.value.length + 1)) * (currentIndex.value + 1)\n  setTransition({\n    duration: height / (textArray.value.length + 1) / props.speed,\n    delay: props.delay,\n    translate\n  })\n}\n\nasync function scroll() {\n  const [wRect, cRect] = await queryRect()\n  if (!wRect.width || !cRect.width || !cRect.height) return\n  wrapRect.value = wRect\n  contentRect.value = cRect\n  wrapWidth.value = wRect.width\n\n  if (isHorizontal.value) {\n    if (props.scrollable) {\n      setTransition({\n        duration: cRect.width / props.speed,\n        delay: props.delay,\n        translate: -cRect.width\n      })\n    }\n  } else {\n    if (textArray.value.length > 1) {\n      verticalAnimate(cRect.height)\n    }\n  }\n}\n\nfunction next() {\n  if (currentIndex.value >= textArray.value.length - 1) {\n    currentIndex.value = 0\n  } else {\n    currentIndex.value++\n  }\n  emit('next', currentIndex.value)\n}\n\nfunction animationEnd() {\n  if (isHorizontal.value) {\n    setTransition({\n      duration: 0,\n      delay: 0,\n      translate: wrapWidth.value + 1\n    })\n  } else {\n    if (++verticalIndex.value >= textArray.value.length) {\n      verticalIndex.value = 0\n      setTransition({\n        duration: 0,\n        delay: 0,\n        translate: 0\n      })\n    }\n  }\n\n  const timer = setTimeout(() => {\n    next() // 更换下一条文本\n\n    nextTick(async () => {\n      try {\n        const [wRect, cRect] = await queryRect()\n        wrapRect.value = wRect\n        contentRect.value = cRect\n        wrapWidth.value = wRect.width || 0\n      } catch (error) {\n        // uni.__f__('error','at uni_modules/wot-design-uni/components/wd-notice-bar/wd-notice-bar.vue:228',error)\n      }\n\n      if (!contentRect.value || !contentRect.value.width || !contentRect.value.height) return\n\n      if (isHorizontal.value) {\n        setTransition({\n          duration: (wrapWidth.value + contentRect.value.width) / props.speed,\n          delay: props.delay,\n          translate: -contentRect.value.width\n        })\n      } else {\n        verticalAnimate(contentRect.value.height)\n      }\n    })\n\n    clearTimeout(timer)\n  }, 20)\n}\n\nfunction handleClick() {\n  const result = isArray(props.text)\n    ? {\n        index: currentIndex.value,\n        text: props.text[currentIndex.value]\n      }\n    : {\n        index: 0,\n        text: props.text\n      }\n  emit('click', result)\n}\n\ndefineExpose<NoticeBarExpose>({ reset })\n</script>\n\n<style lang=\"scss\" scoped>\n@import './index.scss';\n</style>\n","import Component from 'G:/Code/campus/miniProject/uni_modules/wot-design-uni/components/wd-notice-bar/wd-notice-bar.vue'\nwx.createComponent(Component)"],"names":["ref","computed","reactive","objToStyle","isDef","getCurrentInstance","watch","onMounted","onActivated","onDeactivated","nextTick","getRect","isArray"],"mappings":"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"}