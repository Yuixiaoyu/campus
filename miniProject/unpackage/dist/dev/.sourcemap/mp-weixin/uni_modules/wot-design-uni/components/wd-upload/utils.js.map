{"version":3,"file":"utils.js","sources":["uni_modules/wot-design-uni/components/wd-upload/utils.ts"],"sourcesContent":["/*\n * @Author: weisheng\n * @Date: 2024-03-18 22:36:44\n * @LastEditTime: 2024-12-07 18:08:48\n * @LastEditors: weisheng\n * @Description:\n * @FilePath: /wot-design-uni/src/uni_modules/wot-design-uni/components/wd-upload/utils.ts\n * 记得注释\n */\nimport { isArray, isDef } from '../common/util'\nimport type { ChooseFile, ChooseFileOption } from './types'\n\nfunction formatImage(res: UniApp.ChooseImageSuccessCallbackResult): ChooseFile[] {\n  // #ifdef MP-DINGTALK\n  // 钉钉文件在files中\n  res.tempFiles = isDef((res as any).files) ? (res as any).files : res.tempFiles\n  // #endif\n  if (isArray(res.tempFiles)) {\n    const result: ChooseFile[] = []\n    res.tempFiles.forEach(async (item: any) => {\n      result.push({\n        path: item.path || '',\n        name: item.name || '',\n        size: item.size,\n        type: 'image',\n        thumb: item.path || ''\n      })\n    })\n    return result\n  } else {\n    return [\n      {\n        path: (res.tempFiles as any).path || '',\n        name: (res.tempFiles as any).name || '',\n        size: (res.tempFiles as any).size,\n        type: 'image',\n        thumb: (res.tempFiles as any).path || ''\n      }\n    ]\n  }\n}\n\nfunction formatVideo(res: UniApp.ChooseVideoSuccess): ChooseFile[] {\n  return [\n    {\n      path: res.tempFilePath || (res as any).filePath || '',\n      name: res.name || '',\n      size: res.size,\n      type: 'video',\n      thumb: (res as any).thumbTempFilePath || '',\n      duration: res.duration\n    }\n  ]\n}\n\nfunction formatMedia(res: UniApp.ChooseMediaSuccessCallbackResult): ChooseFile[] {\n  return res.tempFiles.map((item) => ({\n    type: item.fileType,\n    path: item.tempFilePath,\n    thumb: item.fileType === 'video' ? item.thumbTempFilePath : item.tempFilePath,\n    size: item.size,\n    duration: item.duration\n  }))\n}\nexport function chooseFile({\n  multiple,\n  sizeType,\n  sourceType,\n  maxCount,\n  accept,\n  compressed,\n  maxDuration,\n  camera\n}: ChooseFileOption): Promise<ChooseFile[]> {\n  return new Promise((resolve, reject) => {\n    switch (accept) {\n      case 'image':\n        uni.chooseImage({\n          count: multiple ? Math.min(maxCount, 9) : 1, // 最多可以选择的数量，如果不支持多选则数量为1\n          sizeType,\n          sourceType,\n          success: (res) => resolve(formatImage(res)),\n          fail: (error) => {\n            reject(error)\n          }\n        })\n        break\n      case 'video':\n        uni.chooseVideo({\n          sourceType,\n          compressed,\n          maxDuration,\n          camera,\n          success: (res) => {\n            resolve(formatVideo(res))\n          },\n          fail: reject\n        })\n\n        break\n      // #ifdef MP-WEIXIN\n      case 'media':\n        uni.chooseMedia({\n          count: multiple ? Math.min(maxCount, 9) : 1,\n          sourceType,\n          sizeType,\n          camera,\n          maxDuration,\n          success: (res) => resolve(formatMedia(res)),\n          fail: reject\n        })\n        break\n      case 'file':\n        uni.chooseMessageFile({\n          count: multiple ? Math.min(maxCount, 100) : 1,\n          type: accept,\n          success: (res) => resolve(res.tempFiles),\n          fail: reject\n        })\n        break\n      // #endif\n      case 'all':\n        // #ifdef MP-WEIXIN\n        uni.chooseMessageFile({\n          count: multiple ? Math.min(maxCount, 100) : 1,\n          type: accept,\n          success: (res) => resolve(res.tempFiles),\n          fail: reject\n        })\n        // #endif\n        // #ifdef H5\n        uni.chooseFile({\n          count: multiple ? Math.min(maxCount, 100) : 1,\n          type: accept,\n          success: (res) => resolve(res.tempFiles as ChooseFile[]),\n          fail: reject\n        })\n        // #endif\n        break\n      default:\n        // 默认选择图片\n        uni.chooseImage({\n          count: multiple ? Math.min(maxCount, 9) : 1, // 最多可以选择的数量，如果不支持多选则数量为1\n          sizeType,\n          sourceType,\n          success: (res) => resolve(formatImage(res)),\n          fail: reject\n        })\n        break\n    }\n  })\n}\n"],"names":["isArray","uni"],"mappings":"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"}